<div ng-controller="groupLoanApprovalActivityController">
    <div class="col-md-12" ng-if="showLoans">
        <form name="managecoapplicants" class="form-horizontal">
            <fieldset>
                <div ng-if="loanApplications.length > 0">
                    <div class="span gray-head">
                        <span class="boldlabel">
                            <strong>{{ 'label.heading.loanapplications' | translate }}</strong>
                        </span>
                    </div>
                    <table class="table table-condensed">
                        <tr class="graybg">
                            <th>{{'label.heading.loan.application.number' | translate}}</th>
                            <th>{{'label.heading.client' | translate}}</th>
                            <th>{{'label.heading.loan.amount.requested' | translate}}</th>
                            <th>{{'label.heading.loanproduct' | translate}}</th>
                            <th>{{'label.heading.actions' | translate}}</th>
                        </tr>
                        <tr class="pointer-main" ng-repeat="loanApp in loanApplications | orderBy:'id':true| filter:isLoanAppIncompleted">
                            <td>
                                <i tooltip="{{loanApp.status.value}}" class="icon-stop {{loanApp.status.code | StatusLookup}}"></i> {{loanApp.loanApplicationReferenceNo}}
                            </td>
                            <td>{{loanApp.clientName}}</td>
                            <td>{{loanApp.loanAmountRequested|number}}</td>
                            <td>{{loanApp.loanProductName}}</td>
                            <td>
                                <a tooltip="{{'label.button.approve' | translate}}" has-permission='APPROVE_LOANAPPLICATIONREFERENCE' ng-click="approveLoan(loanApp)" class="btn btn-xs btn-primary ng-binding">
                                    <i class="icon-ok icon-white"></i>
                                </a>
                            </td>
                        </tr>
                    </table>
                </div>
                <div ng-if="displayOnNoActiveLoanApplication()">
                    {{'error.msg.loan.application.data.empty' | translate}}
                </div>
            </fieldset>
        </form>
    </div>
    <div class="col-md-12" ng-if="approveForm">
        <form class="form-inline" name="approveloanapplicationform" novalidate="" rc-submit="submit()">
            <div class="span gray-head">
                <span class="boldlabel">
                          <strong>{{ 'label.heading.requested.loanapplication.details' | translate }}</strong>
                </span>
            </div>
            <div class="col-md-12 well">
                <div class="col-md-6">
                    <table class="table table-bordered table-striped">
                        <tr>
                            <td>
                                <label>{{ 'label.input.product' | translate }}<span class="required">*</span>:&nbsp;
                                </label>
                                <i class="icon-question-sign" tooltip="{{'label.tooltip.product' | translate}}"></i>
                            </td>
                            <td>{{formData.loanProductName}}</td>
                        </tr>
                        <tr>
                            <td>
                                <label>{{ 'label.input.loanpurpose' | translate }}:&nbsp;</label>
                                <i class="icon-question-sign" tooltip="{{'label.tooltip.loanpurpose' | translate}}"></i></td>
                            <td>{{formData.loanPurpose.name}}</td>
                        </tr>
                        <tr ng-hide="loanaccountinfo.loanEMIPacks">
                            <td>
                                <label>{{ 'label.input.numofrepayments' | translate }}&nbsp;<span class="required"></span>:</label>
                            </td>
                            <td>{{formData.numberOfRepayments}}</td>
                        </tr>
                        <tr ng-if="false && loanaccountinfo.canDefineInstallmentAmount" ng-hide="loanaccountinfo.loanEMIPacks">
                            <td>
                                <label>{{ 'label.input.fixedemiamount' | translate }}:</label>&nbsp;
                            </td>
                            <td>
                                {{formData.fixedEmiAmount}}&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>{{ 'label.input.submittedon' | translate }}:</label>&nbsp;</td>
                            <td>{{formData.submittedOnDate | DateFormat}}</td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-6">
                    <table class="table table-bordered table-striped">
                        <tr>
                            <td>
                                <label>{{ 'label.input.loanofficer' | translate }}:&nbsp;</label>
                                <i class="icon-question-sign" tooltip="{{'label.tooltip.loanofficer' | translate}}"></i></td>
                            <td>{{formData.loanOfficerName}}</td>
                        </tr>
                        <tr ng-hide="loanaccountinfo.loanEMIPacks">
                            <td>
                                <label>{{ 'label.input.requested.principal.amount' | translate }}&nbsp;<span class="required">*</span>:</label>
                            </td>
                            <td>
                                {{formData.loanAmountRequested|number}}&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>{{ 'label.input.loanterm' | translate }}&nbsp;<span class="required"></span>:</label>
                            </td>
                            <td>{{formData.termFrequency}} : {{formData.termPeriodFrequency.value}}</td>
                        </tr>
                        <tr ng-hide="loanaccountinfo.loanEMIPacks">
                            <td>
                                <label>{{ 'label.input.repaidevery' | translate }}&nbsp;<span class="required"></span></label>
                            </td>
                            <td>{{formData.repayEvery}} : {{formData.repaymentPeriodFrequency.value}}</td>
                        </tr>
                        <tr ng-show="formData.expectedDisbursalPaymentType.name">
                            <td>{{'label.heading.preferredpaymentchannelfordisbursements' | translate}}
                            </td>
                            <td><span class="padded-td" ng-show="formData.expectedDisbursalPaymentType">
                                    {{formData.expectedDisbursalPaymentType.name}}</span></td>
                        </tr>
                        <tr ng-show="formData.expectedRepaymentPaymentType.name">
                            <td>{{'label.heading.preferredpaymentchannelforrepayments' | translate}}</td>
                            <td><span class="padded-td" ng-show="formData.expectedRepaymentPaymentType">
                                    {{formData.expectedRepaymentPaymentType.name}}</span></td>
                        </tr>
                        <tr ng-hide="loanaccountinfo.loanEMIPacks">
                            <td>
                                <label>{{ 'label.input.no.of.tranche' | translate }}</label>
                            </td>
                            <td>{{formData.noOfTranche}}</td>
                        </tr>
                    </table>
                </div>
                <div ng-show="formData.loanEMIPackData">
                    <table class="table  table-striped">
                        <thead>
                            <tr>
                                <th>{{ 'label.heading.sanctionAmount' | translate }}</th>
                                <th>{{ 'label.heading.repaymentEvery' | translate }}</th>
                                <th>{{ 'label.heading.numberOfRepayments' | translate }}</th>
                                <th>{{ 'label.heading.fixedEmi' | translate }}</th>
                                <th ng-show="formData.loanEMIPackData.disbursalAmount1">{{ 'label.heading.disbursalAmount1' | translate }}</th>
                                <th ng-show="formData.loanEMIPackData.disbursalAmount2">{{ 'label.heading.disbursalAmount2' | translate }}</th>
                                <th ng-show="formData.loanEMIPackData.disbursalAmount3">{{ 'label.heading.disbursalAmount3' | translate }}</th>
                                <th ng-show="formData.loanEMIPackData.disbursalAmount4">{{ 'label.heading.disbursalAmount4' | translate }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="col-md-1">
                                    <span>{{formData.loanEMIPackData.sanctionAmount}}</span>
                                </td>
                                <td class="col-md-1">
                                    <span>{{formData.loanEMIPackData.repaymentEvery}} - {{formData.loanEMIPackData.repaymentFrequencyType.value}}</span>
                                </td>
                                <td class="col-md-1">
                                    <span>{{formData.loanEMIPackData.numberOfRepayments}}</span>
                                </td>
                                <td class="col-md-1">
                                    <span>{{formData.loanEMIPackData.fixedEmi}}</span>
                                </td>
                                <td class="col-md-1" ng-show="formData.loanEMIPackData.disbursalAmount1">
                                    <span>{{formData.loanEMIPackData.disbursalAmount1}}</span>
                                </td>
                                <td class="col-md-1" ng-show="formData.loanEMIPackData.disbursalAmount2">
                                    <span>{{formData.loanEMIPackData.disbursalAmount2}}</span>
                                </td>
                                <td class="col-md-1" ng-show="formData.loanEMIPackData.disbursalAmount3">
                                    <span>{{formData.loanEMIPackData.disbursalAmount3}}</span>
                                </td>
                                <td class="col-md-1" ng-show="formData.loanEMIPackData.disbursalAmount4">
                                    <span>{{formData.loanEMIPackData.disbursalAmount4}}</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div ng-if="existingCharges.length > 0">
                    <table class="width100">
                        <tr class="bottomborder">
                            <td colspan="5"><strong>{{'label.heading.charges' | translate}}</strong></td>
                        </tr>
                        <tr class="bottomborder graybg">
                            <td>{{'label.heading.name' | translate}}</td>
                            <td>{{'label.heading.type' | translate}}</td>
                            <td>{{'label.heading.amount' | translate}}</td>
                            <td>{{'label.heading.collectedon' | translate}}</td>
                            <td>{{'label.checkbox.ismandatory' | translate}}</td>
                        </tr>
                        <tr ng-repeat="charge in existingCharges">
                            <td>{{charge.name}}</td>
                            <td>{{charge.chargeCalculationType.value}}</td>
                            <td>{{charge.amount|number}}</td>
                            <td>{{charge.chargeTimeType.value}}</td>
                            <td>{{charge.isMandatory == true ? 'Yes': 'No'}}</td>
                        </tr>
                        <tr>
                            <td colspan="5">
                                <br/>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="span gray-head">
                <span class="boldlabel">
                          <strong>{{ 'label.heading.approve.loanapplication.details' | translate }}</strong>
                    </span>
            </div>
            <div class="col-md-12 well">
                <table class="width100" ng-hide="loanaccountinfo.loanEMIPacks">
                    <tr>
                        <td class="width19">
                            <label>{{ 'label.input.approval.amount' | translate }}&nbsp;
                                <span class="required">*</span>:</label>
                        </td>
                        <td class="width31 paddedbottom10">
                            <input type="text" class="form-control" name="loanAmountApproved" ng-model="formRequestData.loanAmountApproved" number-format />&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                        </td>
                        <td class="width19">
                            <label>{{'label.input.expecteddisbursementon' | translate}}
                                <span class="required">*</span>:</label>
                        </td>
                        <td class="width31 paddedbottom10">
                            <input id="expectedDisbursementDate" name="expectedDisbursementDate" type="text" datepicker-pop="{{df}}" ng-model="formRequestData.expectedDisbursementDate" is-open="opened" min="minDate" max="'2020-06-22'" class="form-control" />
                        </td>
                    </tr>

                    <tr>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10">
                            <label>
                                <form-validate valattributeform="approveloanapplicationform" valattribute="loanAmountApproved" />
                            </label>
                        </td>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10">
                            <label>
                                <form-validate valattributeform="approveloanapplicationform" valattribute="expectedDisbursementDate" />
                            </label>
                        </td>
                    </tr>

                    <tr>
                        <td class="width14">
                            <label>{{ 'label.input.numofrepayments' | translate }}&nbsp;
                                <span class="required">*</span>:</label>
                        </td>
                        <td class="paddedbottom10">
                            <input id="numberOfRepayments" name="numberOfRepayments" class="form-control" type="text" ng-model="formRequestData.numberOfRepayments" ng-change="calculateTermFrequency()" />
                        </td>

                        <td>
                            <label>{{ 'label.input.repaidevery' | translate }}&nbsp;<span class="required">*</span></label>
                        </td>
                        <td class="paddedbottom10 ">
                            <input id="repayEvery" class="form-control input-sm" type="text" name="repayEvery" ng-model="formRequestData.repayEvery" late-validate="" ng-change="calculateTermFrequency()" />
                            <select id="repaymentFrequencyType" name="repaymentFrequencyType" class="form-control input-sm" ng-model="formRequestData.repaymentPeriodFrequencyEnum" ng-options="repaymentFrequencyType.id as repaymentFrequencyType.value for repaymentFrequencyType in loanaccountinfo.termFrequencyTypeOptions" value="{{repaymentFrequencyType.id}}" required="" late-validate="" ng-change="calculateTermFrequency()" />
                        </td>
                    </tr>

                    <tr>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10">
                            <label>
                                <form-validate valattributeform="approveloanapplicationform" valattribute="numberOfRepayments" />
                            </label>
                        </td>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10">
                            <label>
                                <form-validate valattributeform="approveloanapplicationform" valattribute="repayEvery" />
                            </label>
                            <label ng-show="formRequestData.repayEvery">
                                <form-validate valattributeform="approveloanapplicationform" valattribute="repaymentFrequencyType" />
                            </label>

                        </td>
                    </tr>

                    <tr>
                        <td class="width19" ng-if="loanaccountinfo.canDefineInstallmentAmount">
                            <label>{{ 'label.input.fixedemiamount' | translate }}:
                            </label>&nbsp;</td>
                        <td class="width36 paddedbottom10" ng-if="loanaccountinfo.canDefineInstallmentAmount">
                            <input id="fixedEmiAmount" name="fixedEmiAmount" type="text" ng-model="formRequestData.fixedEmiAmount" class="form-control" number-format/>&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                        </td>

                        <td class="width19">
                            <label>{{'label.input.approvedondate' | translate}}
                                <span class="required">*</span>:</label>
                        </td>
                        <td class="width31 paddedbottom10">
                            <input id="approvedOnDate" name="approvedOnDate" type="text" datepicker-pop="{{df}}" ng-model="formRequestData.approvedOnDate" is-open="opened" min="minDate" max="restrictDate" class="form-control" />
                    </tr>

                    <tr>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10">

                        </td>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10">
                            <label>
                                <form-validate valattributeform="approveloanapplicationform" valattribute="approvedOnDate" />
                            </label>
                        </td>
                    </tr>

                    <tr>
                        <td class="width25" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.repaymentsStartingFromDate == true">
                            <label>{{ 'label.input.firstrepaymenton' | translate }}<span class="required" ng-show="response.uiDisplayConfigurations.loanAccount.isMandatory.repaymentsStartingFromDate">*</span>:&nbsp;
                            </label>
                            <i class="icon-question-sign" tooltip="{{'label.tooltip.firstrepaymenton' | translate}}"></i>
                        </td>
                        <td class="width25 paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.repaymentsStartingFromDate == true">
                            <input id="repaymentsStartingFromDate" name="repaymentsStartingFromDate" type="text" datepicker-pop="{{df}}" ng-model="formRequestData.repaymentsStartingFromDate" is-open="opened3" min="minDate" max="'2020-06-22'" class="form-control" ng-required="response.uiDisplayConfigurations.loanAccount.isMandatory.repaymentsStartingFromDate" />
                        </td>

                        <td class="width19"></td>
                        <td class="width31 paddedbottom10"></td>
                    </tr>

                    <tr>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10">
                            <span class="error" ng-show="issubmitted && approveloanapplicationform.repaymentsStartingFromDate.$error.required">{{'label.error.required' | translate}}</span>
                        </td>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10"></td>
                    </tr>

                    <tr>
                        <td colspan="4">&nbsp;</td>
                    </tr>
                </table>
                <table class="width100" ng-show="loanaccountinfo.loanEMIPacks">
                    <tr>
                        <td class="width19">
                            <label>{{'label.input.approvedondate' | translate}}
                                <span class="required">*</span>:</label>
                        </td>
                        <td class="width31 paddedbottom10">
                            <input id="approvedOnDate1" name="approvedOnDate" type="text" datepicker-pop="{{df}}" ng-model="formRequestData.approvedOnDate" is-open="opened" min="minDate" max="restrictDate" class="form-control" />
                        </td>
                        <td class="width19">
                            <label>{{'label.input.expecteddisbursementon' | translate}}
                                <span class="required">*</span>:</label>
                        </td>
                        <td class="width31 paddedbottom10">
                            <input id="expectedDisbursementDate1" name="expectedDisbursementDate" type="text" datepicker-pop="{{df}}" ng-model="formRequestData.expectedDisbursementDate" is-open="opened" min="minDate" max="'2020-06-22'" class="form-control" />
                        </td>
                    </tr>

                    <tr>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10">
                            <label>
                                <form-validate valattributeform="approveloanapplicationform" valattribute="approvedOnDate" />
                            </label>
                        </td>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10">
                            <label>
                                <form-validate valattributeform="approveloanapplicationform" valattribute="expectedDisbursementDate" />
                            </label>
                        </td>
                    </tr>

                    <tr>
                        <td class="width25" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.repaymentsStartingFromDate == true">
                            <label>{{ 'label.input.firstrepaymenton' | translate }}<span class="required" ng-show="response.uiDisplayConfigurations.loanAccount.isMandatory.repaymentsStartingFromDate">*</span>:&nbsp;
                            </label>
                            <i class="icon-question-sign" tooltip="{{'label.tooltip.firstrepaymenton' | translate}}"></i>
                        </td>
                        <td class="width25 paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.repaymentsStartingFromDate == true">
                            <input id="repaymentsStartingFromDate1" name="repaymentsStartingFromDate" type="text" datepicker-pop="{{df}}" ng-model="formRequestData.repaymentsStartingFromDate" is-open="opened3" min="minDate" max="'2020-06-22'" class="form-control" ng-required="response.uiDisplayConfigurations.loanAccount.isMandatory.repaymentsStartingFromDate" />
                        </td>

                        <td class="width19"></td>
                        <td class="width31 paddedbottom10"></td>
                    </tr>

                    <tr>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10">
                            <span class="error" ng-show="issubmitted && approveloanapplicationform.repaymentsStartingFromDate.$error.required">{{'label.error.required' | translate}}</span>
                        </td>
                        <td class="width19"></td>
                        <td class="width31 paddedbottom10"></td>
                    </tr>

                    <tr>
                        <td colspan="4">&nbsp;</td>
                    </tr>
                    <tr ng-show="loanaccountinfo.loanEMIPacks && changeLoanEMIPack" class="width100">
                        <td colspan="4">
                            <label><strong>{{ 'label.heading.chooseloanemipack' | translate }}</strong></label>
                        </td>
                    </tr>
                    <tr ng-show="loanaccountinfo.loanEMIPacks && changeLoanEMIPack" class="width100">
                        <td colspan="4">
                            <input ng-autofocus="true" ng-model="filterText" type="text" ng-keyup="onFilter()" class="form-control width100" placeholder="{{'label.input.filterbytext' | translate}}" />
                        </td>
                    </tr>
                    <tr ng-show="loanaccountinfo.loanEMIPacks" class="width100">
                        <td colspan="4">
                            <div>
                                <div ng-hide="changeLoanEMIPack">
                                    <table class="table  table-striped">
                                        <thead>
                                            <tr>
                                                <th>{{ 'label.heading.sanctionAmount' | translate }}</th>
                                                <th>{{ 'label.heading.repaymentEvery' | translate }}</th>
                                                <th>{{ 'label.heading.numberOfRepayments' | translate }}</th>
                                                <th>{{ 'label.heading.fixedEmi' | translate }}</th>
                                                <th ng-show="formData.loanEMIPackData.disbursalAmount1">{{ 'label.heading.disbursalAmount1' | translate }}</th>
                                                <th ng-show="formData.loanEMIPackData.disbursalAmount2">{{ 'label.heading.disbursalAmount2' | translate }}</th>
                                                <th ng-show="formData.loanEMIPackData.disbursalAmount3">{{ 'label.heading.disbursalAmount3' | translate }}</th>
                                                <th ng-show="formData.loanEMIPackData.disbursalAmount4">{{ 'label.heading.disbursalAmount4' | translate }}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="col-md-1">
                                                    <span>{{formData.loanEMIPackData.sanctionAmount}}</span>
                                                </td>
                                                <td class="col-md-1">
                                                    <span>{{formData.loanEMIPackData.repaymentEvery}} - {{formData.loanEMIPackData.repaymentFrequencyType.value}}</span>
                                                </td>
                                                <td class="col-md-1">
                                                    <span>{{formData.loanEMIPackData.numberOfRepayments}}</span>
                                                </td>
                                                <td class="col-md-1">
                                                    <span>{{formData.loanEMIPackData.fixedEmi}}</span>
                                                </td>
                                                <td class="col-md-1" ng-show="formData.loanEMIPackData.disbursalAmount1">
                                                    <span>{{formData.loanEMIPackData.disbursalAmount1}}</span>
                                                </td>
                                                <td class="col-md-1" ng-show="formData.loanEMIPackData.disbursalAmount2">
                                                    <span>{{formData.loanEMIPackData.disbursalAmount2}}</span>
                                                </td>
                                                <td class="col-md-1" ng-show="formData.loanEMIPackData.disbursalAmount3">
                                                    <span>{{formData.loanEMIPackData.disbursalAmount3}}</span>
                                                </td>
                                                <td class="col-md-1" ng-show="formData.loanEMIPackData.disbursalAmount4">
                                                    <span>{{formData.loanEMIPackData.disbursalAmount4}}</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div ng-hide="changeLoanEMIPack">
                                    <a ng-click="changeEmi()" class="btn btn-default ng-binding">{{'label.button.changeemipack' | translate}}
                                    </a>
                                </div>
                                <table class="table  table-striped" ng-show="changeLoanEMIPack">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>{{ 'label.heading.sanctionAmount' | translate }}</th>
                                            <th>{{ 'label.heading.repaymentEvery' | translate }}</th>
                                            <th>{{ 'label.heading.numberOfRepayments' | translate }}</th>
                                            <th>{{ 'label.heading.fixedEmi' | translate }}</th>
                                            <th ng-show="loanaccountinfo.multiDisburseLoan">{{ 'label.heading.disbursalAmount1' | translate }}</th>
                                            <th ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 1">{{ 'label.heading.disbursalAmount2' | translate }}</th>
                                            <th ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 2">{{ 'label.heading.disbursalAmount3' | translate }}</th>
                                            <th ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 3">{{ 'label.heading.disbursalAmount4' | translate }}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr data-ng-repeat="loanEMIPack in loanaccountinfo.loanEMIPacks | filter:filterText" ng-if="loanEMIPack.sanctionAmount <= formData.loanEMIPackData.sanctionAmount">
                                            <td class="col-md-1">
                                                <input type="radio" ng-model="formRequestData.loanEMIPackId" value="{{loanEMIPack.id}}" />
                                            </td>
                                            <td class="col-md-1">
                                                <span>{{loanEMIPack.sanctionAmount}}</span>
                                            </td>
                                            <td class="col-md-1">
                                                <span>{{loanEMIPack.combinedRepayEvery}}</span>
                                            </td>
                                            <td class="col-md-1">
                                                <span>{{loanEMIPack.numberOfRepayments}}</span>
                                            </td>
                                            <td class="col-md-1">
                                                <span>{{loanEMIPack.fixedEmi}}</span>
                                            </td>
                                            <td class="col-md-1" ng-show="loanaccountinfo.multiDisburseLoan">
                                                <span>{{loanEMIPack.disbursalAmount1}}</span>
                                            </td>
                                            <td class="col-md-1" ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 1">
                                                <span>{{loanEMIPack.disbursalAmount2}}</span>
                                            </td>
                                            <td class="col-md-1" ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 2">
                                                <span>{{loanEMIPack.disbursalAmount3}}</span>
                                            </td>
                                            <td class="col-md-1" ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 3">
                                                <span>{{loanEMIPack.disbursalAmount4}}</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </td>
                    </tr>
                </table>
                <label ng-show="loanaccountinfo.calendarOptions"><i class="icon-calendar icon-white"></i>&nbsp;<strong>{{
                                'label.heading.meetingdetails' | translate }}</strong></label>
                <table ng-show="loanaccountinfo.calendarOptions" class="width100">
                    <tr ng-repeat="calendar in loanaccountinfo.calendarOptions">
                        <td class="width14">
                            <label>{{ 'label.heading.startdate' | translate }}:
                            </label>
                        </td>
                        <td class="width36">{{calendar.startDate | DateFormat}}</td>
                        <td class="width14" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.syncDisbursementDateWithMeeting">
                            <label>{{ 'label.heading.repeatson' | translate }}:</label>
                        </td>
                        <td class="width36" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.syncDisbursementDateWithMeeting">
                            {{calendar.humanReadable}}
                        </td>
                    </tr>
                    <tr ng-repeat="calendar in loanaccountinfo.calendarOptions">
                        <td align="center">
                            <input type="checkbox" ng-model="formValidationData.syncRepaymentsWithMeeting" ng-change="syncRepaymentsWithMeetingchange()" ng-disabled="response.uiDisplayConfigurations.loanAccount.isReadOnlyField.syncRepaymentsWithMeeting">
                        </td>
                        <td>
                            <label>{{ 'label.input.syncrepaymentswithmeeting' | translate }}</label>
                        </td>
                        <td align="center" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.syncDisbursementDateWithMeeting">
                            <input type="checkbox" ng-model="formValidationData.syncDisbursementWithMeeting" ng-change="syncDisbursementWithMeetingchange()">
                        </td>
                        <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.syncDisbursementDateWithMeeting">
                            <label>{{ 'label.input.syncdisbursementdatewithmeeting' | translate }}
                            </label>
                        </td>
                    </tr>
                </table>

                <div ng-show="loanaccountinfo.product.multiDisburseLoan">
                    <hr/>
                    <label>
                        <strong>{{ 'label.heading.tranchedetails' | translate }}</strong>
                    </label>

                    <table class="width100">
                        <tr>
                            <td class="width14">
                                <label>{{'label.input.outstandingloanbalance' | translate}}:
                                </label>
                            </td>
                            <td class="width36 paddedbottom10">
                                <input id="maxOutstandingLoanBalance" type="text" ng-model="formRequestData.maxOutstandingLoanBalance" class="form-control" number-format/>&nbsp;
                                <a href="javascript:void(0)" title="{{ 'label.button.addtranch' | translate }}" ng-click="addTranches()" ng-show="formRequestData.loanApplicationSanctionTrancheDatas.length < loanaccountinfo.product.maxTrancheCount">
                                    <i class="icon-plus icon-white"></i>
                                </a>
                            </td>
                        </tr>
                    </table>

                    <table class="table width100" ng-show="isSanctionTrancheData()">
                        <thead>
                            <tr class="graybg">
                                <th>{{'label.heading.serialno' | translate}}</th>
                                <th>{{'label.input.expecteddisbursementon' | translate}}</th>
                                <th>{{'label.input.principal' | translate}}</th>
                                <th ng-if="false">{{'label.input.fixedemiamount' | translate}}</th>
                                <th>{{'label.heading.actions' | translate}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="disbursementDetail in formRequestData.loanApplicationSanctionTrancheDatas track by $index">
                                <td>{{($index+1)}}</td>
                                <td>
                                    <input id="disbursementDetail[{{$index}}].expectedTrancheDisbursementDate" name="expectedTrancheDisbursementDate" type="text" datepicker-pop="{{df}}" placeholder="{{'label.input.expecteddisbursementon' | translate}}" ng-model="disbursementDetail.expectedTrancheDisbursementDate" is-open="'openedtranche'+$index" min="minDate" max="'2020-06-22'" class="form-control" required ng-disabled="$index == 0" />
                                    <form-validate valattributeform="approveloanapplicationform" valattribute="expectedTrancheDisbursementDate" />
                                </td>
                                <td>
                                    <input id="{{disbursementDetail[$index].trancheAmount}}" name="trancheAmount" class="input-sm form-control" number-format type="text" ng-model="disbursementDetail.trancheAmount" placeholder="{{'label.input.principal' | translate}}" required late-validate="">

                                    <form-validate valattributeform="approveloanapplicationform" valattribute="trancheAmount" />
                                </td>
                                <td ng-if="false">
                                    <input id="{{disbursementDetail[$index].fixedEmiAmount}}" class="input-sm form-control" number-format type="text" ng-model="disbursementDetail.fixedEmiAmount" placeholder="{{'label.input.fixedemiamount' | translate}}">
                                </td>
                                <td><a ng-click="deleteTranches($index)" ng-show="formRequestData.loanApplicationSanctionTrancheDatas.length > 1"><i class="icon-remove icon-white"></i></a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <hr/>
                <div class="col-md-12">
                    <label><strong>{{ 'label.heading.charges' | translate }}</strong></label>
                    <select ng-model="chargeFormData.chargeId" ng-options="charge.id as (charge.name + ',' + charge.currency.displaySymbol) for charge in loanaccountinfo.chargeOptions|filter:loanaccountinfo.currency.code:strict" value="{{charge.id}}" class="form-control width170px">
                        <option value="">{{'label.selectcharge' | translate}}</option>
                    </select>
                    <a href="javascript:void(0)" ng-click="addCharge()"><i class="icon-plus icon-white"></i></a>
                </div>
                <table class="table" class="width100" ng-show="charges.length>0">
                    <tr class="graybg">
                        <th>{{'label.heading.name' | translate}}</th>
                        <th>{{'label.heading.type' | translate}}</th>
                        <th>{{'label.heading.amount' | translate}}</th>
                        <th>{{'label.heading.collectedon' | translate}}</th>
                        <th>{{'label.heading.date' | translate}}</th>
                        <th>{{'label.heading.actions' | translate}}</th>
                    </tr>
                    <tr ng-repeat="charge in charges">
                        <td>{{charge.name}},{{charge.currency.displaySymbol}}</td>
                        <td>{{charge.chargeCalculationType.value}}</td>
                        <td>
                            <input id="{{charges[$index].amount}}" class="form-control" type="text" ng-model="charge.amount" placeholder="{{'label.input.amount' | translate}}" ng-readonly="!hasPermission('UPDATE_LOANCHARGE') || charge.chargeTimeType.id == 50
                        || charge.chargeCalculationType.id == 6 || charge.isAmountNonEditable">
                        </td>
                        <td>{{charge.chargeTimeType.value}}</td>
                        <td>
                            <input id="charges[{{$index}}].duedate" type="text" datepicker-pop="{{df}}" class="form-control" placeholder="{{'label.input.duedate' | translate}}" ng-model="charge.dueDate" is-open="'openedch'+$index" min="minDate" max="'2020-06-22'" />
                        </td>
                        <td ng-hide="charge.isMandatory == true" has-permission='DELETE_LOANCHARGE'><a ng-click="deleteCharge($index)"><i class="icon-remove icon-white"></i></a></td>
                    </tr>
                </table>

                <div>
                    
                    <button type="button" class="btn btn-primary pull-right" ng-show="repaymentscheduleinfo.periods.length > 0 && response.uiDisplayConfigurations.viewLoanAccountDetails.isHiddenFeild.viewReportButton" ng-click="viewRepaymentDetails()">{{'label.button.viewReport' | translate}}
                    </button>
                </div>

                 <div ng-show="repaymentscheduleinfo.periods" ng-include="'views/loans/loanrepaymentpreview.html'" />

                <div class="col-md-offset-5">
                    <button id="cancel" type="reset" class="btn btn-default" ng-click="cancel()">
                        {{'label.button.cancel' | translate}}
                    </button>
                    <button id="save" ng-click="issubmitted=true" ng-show="formData.status.id === 200" type="submit" has-permission='APPROVE_LOANAPPLICATIONREFERENCE' class="btn btn-primary">
                        {{'label.button.approve' | translate}}
                    </button>
                    <a class="btn btn-primary" href="javascript:void(0);" data-ng-click="previewRepayments(true)">
                        {{'label.button.schedulepreview' | translate}}</a>
                </div>
            </div>
            <table class="width100">
                <tr>
                    <td colspan="4">&nbsp;</td>
                </tr>
            </table>
        </form>
    </div>
</div>