<div ng-controller="groupLoanDisbursalActivityController">
    <div class="col-md-12" ng-if="showLoans">
        <form name="managecoapplicants" class="form-horizontal">
            <api-validate></api-validate>
            <fieldset>
                <div ng-if="loanApplications.length > 0">
                    <div class="span gray-head">
                        <span class="boldlabel">
                            <strong>{{ 'label.heading.loanapplications' | translate }}</strong>
                        </span>
                    </div>
                    <table class="table table-condensed">
                        <tr class="graybg">
                            <th>{{'label.heading.loan.application.number' | translate}}</th>
                            <th>{{'label.heading.client' | translate}}</th>
                            <th>{{'label.heading.loan.amount.requested' | translate}}</th>
                            <th>{{'label.heading.loanproduct' | translate}}</th>
                            <th>{{'label.input.adhoc.search.loanstatus' | translate}}</th>
                            <th>{{'label.heading.actions' | translate}}</th>
                        </tr>
                        <tr class="pointer-main" ng-repeat="loanApp in loanApplications | orderBy:'id':true| filter:isLoanAppIncompleted">
                            <td>
                                <i tooltip="{{loanApp.status.value}}" class="icon-stop {{loanApp.status.code | StatusLookup}}"></i> {{loanApp.loanApplicationReferenceNo}}
                            </td>
                            <td>{{loanApp.clientName}}</td>
                            <td>{{loanApp.loanAmountRequested|number}}</td>
                            <td>{{loanApp.loanProductName}}</td>
                            <td>{{loanApp.statusInReadableFormat}}</td>
                            <td ng-if="loanApp.status.id == 300">
                                <a tooltip="{{'label.button.disburse' | translate}}" has-permission='DISBURSE_LOANAPPLICATIONREFERENCE' ng-click="disburseLoan(loanApp.loanApplicationReferenceId)">
                                    <i class="icon-flag icon-white"></i>
                                </a>
                            </td>
                        </tr>
                    </table>
                </div>
                <div ng-if="displayOnNoActiveLoanApplication()">
                    {{'error.msg.loan.application.data.empty' | translate}}
                </div>
            </fieldset>
        </form>
    </div>
    <div class="col-md-12" ng-if="disburseForm">
        <form class="form-inline" name="disburseloanapplicationreferenceform" novalidate="" rc-submit="submit()">
            <api-validate></api-validate>
            <div class="span gray-head">
                <span class="boldlabel">
                          <strong>{{ 'label.heading.requested.loanapplication.details' | translate }}</strong>
                    </span>
            </div>
            <div class="col-md-12 well">
                <div class="col-md-6">
                    <table class="table table-bordered table-striped">
                        <tr>
                            <td>
                                <label>{{ 'label.input.product' | translate }}<span class="required">*</span>:&nbsp;
                                </label>
                                <i class="icon-question-sign" tooltip="{{'label.tooltip.product' | translate}}"></i>
                            </td>
                            <td>{{formData.loanProductName}}</td>
                        </tr>
                        <tr>
                            <td>
                                <label>{{ 'label.input.loanpurpose' | translate }}:&nbsp;</label>
                                <i class="icon-question-sign" tooltip="{{'label.tooltip.loanpurpose' | translate}}"></i></td>
                            <td>{{formData.loanPurpose.name}}</td>
                        </tr>
                        <tr>
                            <td>
                                <label>{{ 'label.input.loanterm' | translate }}&nbsp;<span class="required"></span>:</label>
                            </td>
                            <td>{{formData.termFrequency}} : {{formData.termPeriodFrequency.value}}</td>
                        </tr>
                        <tr ng-if="false && loanaccountinfo.canDefineInstallmentAmount">
                            <td>
                                <label>{{ 'label.input.fixedemiamount' | translate }}:</label>&nbsp;</td>
                            <td>
                                {{formData.fixedEmiAmount}}&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>{{ 'label.input.submittedon' | translate }}:</label>&nbsp;</td>
                            <td>{{formData.submittedOnDate | DateFormat}}</td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-6">
                    <table class="table table-bordered table-striped">
                        <tr>
                            <td>
                                <label>{{ 'label.input.loanofficer' | translate }}:&nbsp;</label>
                                <i class="icon-question-sign" tooltip="{{'label.tooltip.loanofficer' | translate}}"></i></td>
                            <td>{{formData.loanOfficerName}}</td>
                        </tr>
                        <tr>
                            <td>
                                <label>{{ 'label.input.requested.principal.amount' | translate }}&nbsp;<span class="required">*</span>:</label>
                            </td>
                            <td>
                                {{formData.loanAmountRequested | number}}&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <label>{{ 'label.input.repaidevery' | translate }}&nbsp;<span class="required"></span></label>
                            </td>
                            <td>{{formData.repayEvery}} : {{formData.repaymentPeriodFrequency.value}}</td>
                        </tr>
                        <tr>
                            <td>
                                <label>{{ 'label.input.no.of.tranche' | translate }}</label>
                            </td>
                            <td>{{formData.noOfTranche}}</td>
                        </tr>
                    </table>
                </div>
                <div ng-if="charges.length > 0" ng-hide="formData.status.id > 200">
                    <table class="width100">
                        <tr class="bottomborder">
                            <td colspan="4"><strong>{{'label.heading.charges' | translate}}</strong></td>
                        </tr>
                        <tr class="bottomborder graybg">
                            <td>{{'label.heading.name' | translate}}</td>
                            <td>{{'label.heading.type' | translate}}</td>
                            <td>{{'label.heading.amount' | translate}}</td>
                            <td>{{'label.heading.collectedon' | translate}}</td>
                        </tr>
                        <tr ng-repeat="charge in charges">
                            <td>{{charge.name}}</td>
                            <td>{{charge.chargeCalculationType.value}}</td>
                            <td>{{charge.amount|number}}</td>
                            <td>{{charge.chargeTimeType.value}}</td>
                        </tr>
                        <tr>
                            <td colspan="4">
                                <br/>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>

            <div ng-show="formData.status.id > 200">

                <div class="span gray-head" ng-show="formData.status.id > 200">
                    <span class="boldlabel">
                            <strong>{{ 'label.heading.approved.loanapplication.details' | translate }}</strong>
                        </span>
                </div>
                <div class="col-md-12 well" ng-show="formData.status.id > 200">
                    <div class="col-md-6">
                        <table class="table table-bordered table-striped">
                            <tr>
                                <td>
                                    <label>{{ 'label.input.product' | translate }}<span class="required">*</span>:&nbsp;
                                    </label>
                                    <i class="icon-question-sign" tooltip="{{'label.tooltip.product' | translate}}"></i>
                                </td>
                                <td>{{formData.loanProductName}}</td>
                            </tr>
                            <tr>
                                <td>
                                    <label>{{ 'label.input.loanpurpose' | translate }}:&nbsp;</label>
                                    <i class="icon-question-sign" tooltip="{{'label.tooltip.loanpurpose' | translate}}"></i></td>
                                <td>{{formData.loanPurpose.name}}</td>
                            </tr>
                            <tr>
                                <td>
                                    <label>{{ 'label.input.loanterm' | translate }}&nbsp;<span class="required"></span>:</label>
                                </td>
                                <td>{{formData.approvedData.termFrequency}} : {{formData.approvedData.termPeriodFrequency.value}}
                                </td>
                            </tr>
                            <tr ng-if="false && loanaccountinfo.canDefineInstallmentAmount">
                                <td>
                                    <label>{{ 'label.input.fixedemiamount' | translate }}:</label>&nbsp;
                                </td>
                                <td>{{formData.approvedData.fixedEmiAmount}}&nbsp;{{loanaccountinfo.currency.displaySymbol}}</td>
                            </tr>
                            <tr>
                                <td>
                                    <label>{{ 'label.input.submittedon' | translate }}:</label>&nbsp;</td>
                                <td>{{formData.submittedOnDate | DateFormat}}</td>
                            </tr>
                            <tr>
                                <td>
                                    <label>{{ 'label.input.approvedondate' | translate }}:</label>&nbsp;
                                </td>
                                <td>{{formData.approvedData.approvedOnDate | DateFormat}}</td>
                            </tr>
                            <tr>
                                <td>
                                    <label>{{ 'label.input.loanaccountnumber' | translate }}:</label>&nbsp;</td>
                                <td>{{formData.loanAccountNum}}</td>
                                </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-bordered table-striped">
                            <tr>
                                <td>
                                    <label>{{ 'label.input.loanofficer' | translate }}:&nbsp;</label>
                                    <i class="icon-question-sign" tooltip="{{'label.tooltip.loanofficer' | translate}}"></i></td>
                                <td>{{formData.loanOfficerName}}</td>
                            </tr>
                            <tr>
                                <td>
                                    <label>{{ 'label.heading.approvedamount' | translate }}&nbsp;<span class="required">*</span>:</label>
                                </td>
                                <td>
                                    {{formData.approvedData.loanAmountApproved|number}}&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>{{ 'label.input.repaidevery' | translate }}&nbsp;<span class="required"></span></label>
                                </td>
                                <td>{{formData.approvedData.repayEvery}} : {{formData.approvedData.repaymentPeriodFrequency.value}}
                                </td>
                            </tr>
                            <tr ng-show="formData.expectedDisbursalPaymentType.name">
                                <td>{{'label.heading.preferredpaymentchannelfordisbursements' | translate}}</td>
                                <td><span class="padded-td">{{formData.expectedDisbursalPaymentType.name}}</span></td>
                            </tr>
                            <tr ng-show="formData.expectedRepaymentPaymentType.name">
                                <td>{{'label.heading.preferredpaymentchannelforrepayments' | translate}}</td>
                                <td><span class="padded-td">{{formData.expectedRepaymentPaymentType.name}}</span></td>
                            </tr>
                            <tr>
                                <td>
                                    <label>{{ 'label.input.no.of.tranche' | translate }}</label>
                                </td>
                                <td>{{formData.noOfTranche}}</td>
                            </tr>
                            <tr>
                                <td>
                                    <label>{{ 'label.input.expecteddisbursementon' | translate }}:</label>&nbsp;
                                </td>
                                <td>{{formData.approvedData.expectedDisbursementDate | DateFormat}}</td>
                            </tr>
                        </table>
                    </div>
                    <div width="width100" ng-if="formData.approvedData.loanApplicationSanctionTrancheDatas.length > 0">
                        <table class="width100">
                            <tr class="bottomborder">
                                <td colspan="4"><strong>{{'label.heading.tranche' | translate}}</strong>
                                </td>
                            </tr>
                            <tr class="bottomborder graybg">
                                <td>{{'label.input.tranche.amount' | translate}}</td>
                                <td ng-if="false && loanaccountinfo.canDefineInstallmentAmount">
                                    {{'label.input.fixedemiamount' | translate}}
                                </td>
                                <td>{{'label.input.expecteddisbursementon' | translate}}</td>
                            </tr>
                            <tr ng-repeat="trancheData in formData.approvedData.loanApplicationSanctionTrancheDatas">
                                <td>{{trancheData.trancheAmount | number}}</td>
                                <td ng-if="false && loanaccountinfo.canDefineInstallmentAmount">
                                    {{trancheData.fixedEmiAmount | number}}
                                </td>
                                <td>{{trancheData.expectedTrancheDisbursementDate|DateFormat}}</td>
                            </tr>
                            <tr>
                                <td colspan="4">
                                    <br/>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div width="width100" ng-if="charges.length > 0">
                        <table class="width100">
                            <tr class="bottomborder">
                                <td colspan="4"><strong>{{'label.heading.charges' | translate}}</strong>
                                </td>
                            </tr>
                            <tr class="bottomborder graybg">
                                <td>{{'label.heading.name' | translate}}</td>
                                <td>{{'label.heading.type' | translate}}</td>
                                <td>{{'label.heading.amount' | translate}}</td>
                                <td>{{'label.heading.collectedon' | translate}}</td>
                            </tr>
                            <tr ng-repeat="charge in charges">
                                <td>{{charge.name}}</td>
                                <td>{{charge.chargeCalculationType.value}}</td>
                                <td>{{charge.amount|number}}</td>
                                <td>{{charge.chargeTimeType.value}}</td>
                            </tr>
                            <tr>
                                <td colspan="4">
                                    <br/>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="col-md-12 well">
                    <div class="col-md-12">
                        <label ng-show="loanaccountinfo.calendarOptions"><i class="icon-calendar icon-white"></i>&nbsp;<strong>{{
                                        'label.heading.meetingdetails' | translate }}</strong></label>
                        <table ng-show="loanaccountinfo.calendarOptions" class="width100">
                            <tr ng-repeat="calendar in loanaccountinfo.calendarOptions">
                                <td class="width14">
                                    <label>{{ 'label.heading.startdate' | translate }}:
                                    </label>
                                </td>
                                <td class="width36">{{calendar.startDate | DateFormat}}</td>
                                <td class="width14" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.syncDisbursementDateWithMeeting">
                                    <label>{{ 'label.heading.repeatson' | translate }}:</label>
                                </td>
                                <td class="width36" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.syncDisbursementDateWithMeeting">
                                    {{calendar.humanReadable}}
                                </td>
                            </tr>

                            <tr ng-repeat="calendar in loanaccountinfo.calendarOptions">
                                <td align="center">
                                    <input type="checkbox" ng-model="syncRepaymentsWithMeeting" ng-change="syncRepaymentsWithMeetingchange()" ng-disabled="response.uiDisplayConfigurations.loanAccount.isReadOnlyField.syncRepaymentsWithMeeting">
                                </td>
                                <td>
                                    <label>{{ 'label.input.syncrepaymentswithmeeting' | translate }}</label>
                                </td>
                                <td align="center" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.syncDisbursementDateWithMeeting">
                                    <input type="checkbox" ng-model="formRequestData.submitApplication.syncDisbursementWithMeeting" ng-change="syncDisbursementWithMeetingchange()">
                                </td>
                                <td ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.syncDisbursementDateWithMeeting">
                                    <label>{{ 'label.input.syncdisbursementdatewithmeeting' | translate }}
                                    </label>
                                </td>
                            </tr>
                        </table>
                        <hr>
                        <table class="width100">
                            <tr>
                                <td class="width25">
                                    <label>{{ 'label.input.disbursedon' | translate }}<span class="required">*</span>:&nbsp;</label>
                                </td>
                                <td class="width25 paddedbottom10">
                                    <input id="actualDisbursementDate" name="actualDisbursementDate" type="text" autocomplete="off" datepicker-pop="{{df}}" placeholder="{{'label.tooltip.disbursementon' | translate}}" ng-model="formRequestData.disburse.actualDisbursementDate" is-open="opened" min="minDate" max="globalMaxDate" class="form-control" ng-readonly="isDatePickerReadOnly" ng-bind="updateTrancheDate()" required/>
                                </td>

                                <td class="width25" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.repaymentsStartingFromDate == true">
                                    <label>{{ 'label.input.firstrepaymenton' | translate }}<span class="required" ng-show="response.uiDisplayConfigurations.loanAccount.isMandatory.repaymentsStartingFromDate">*</span>:&nbsp;
                                    </label>
                                    <i class="icon-question-sign" tooltip="{{'label.tooltip.firstrepaymenton' | translate}}"></i>
                                </td>
                                <td class="width25 paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.repaymentsStartingFromDate == true">
                                    <input id="repaymentsStartingFromDate" name="repaymentsStartingFromDate" type="text" autocomplete="off" datepicker-pop="{{df}}" ng-model="date.repaymentsStartingFromDate" is-open="opened3" min="minDate" max="globalMaxDate" class="form-control" ng-required="response.uiDisplayConfigurations.loanAccount.isMandatory.repaymentsStartingFromDate" ng-readonly="isDatePickerReadOnly" />
                                </td>
                            </tr>
                            <tr>
                                <td class="width25"></td>
                                <td class="width25 paddedbottom10">
                                    <form-validate valattributeform="disburseloanapplicationreferenceform" valattribute="actualDisbursementDate" />
                                </td>
                                <td class="width25"></td>
                                <td class="width25 paddedbottom10">
                                    <span class="error" ng-show="disburseloanapplicationreferenceform.repaymentsStartingFromDate.$error.required">{{'label.error.required' | translate}}</span>
                                </td>
                            </tr>
                            <tr>
                                <td class="width25">
                                    <label>{{ 'label.input.transactionamount' | translate }}&nbsp;
                                        <span class="required">*</span>:</label>
                                </td>
                                <td class="width25 paddedbottom10">
                                    <input type="text" autocomplete="off" class="form-control" name="transactionAmount" ng-readonly="isAmountReadOnly" ng-model="formRequestData.disburse.transactionAmount"  number-format required/>&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                                </td>

                                <td class="width25" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.interestChargedFromDate == true">
                                    <label class="control-label">{{ 'label.input.interestchargedfrom' | translate }}:
                                    </label>
                                    <i class="icon-question-sign" tooltip="{{'label.tooltip.interestchargedfrom' | translate}}"></i>
                                </td>
                                <td class="width25 paddedbottom10" ng-hide="response.uiDisplayConfigurations.loanAccount.isHiddenField.interestChargedFromDate == true">
                                    <input id="interestChargedFromDate" type="text" autocomplete="off" datepicker-pop="{{df}}" ng-model="date.interestChargedFromDate" is-open="opened2" min="minDate" max="globalMaxDate" class="form-control" ng-disabled="response.uiDisplayConfigurations.loanAccount.isReadOnlyField.interestChargedFromDate" ng-readonly="isDatePickerReadOnly" />
                                </td>
                            </tr>
                            <tr>
                                <td class="width25"></td>
                                <td class="width25 paddedbottom10">
                                    <form-validate valattributeform="disburseloanapplicationreferenceform" valattribute="transactionAmount" />
                                </td>
                                <td class="width25"></td>
                                <td class="width25 paddedbottom10"></td>
                            </tr>
                            <tr>

                                <td class="width19" ng-if="loanaccountinfo.canDefineInstallmentAmount">
                                    <label>{{ 'label.input.fixedemiamount' | translate }}:
                                    </label>&nbsp;</td>
                                <td class="width36 paddedbottom10" ng-if="loanaccountinfo.canDefineInstallmentAmount">
                                    <input id="fixedEmiAmount" name="fixedEmiAmount" type="text" autocomplete="off" ng-model="formRequestData.disburse.fixedEmiAmount" ng-readonly = "isFixedEmiReadOnly"  class="form-control" number-format/>&nbsp;{{loanaccountinfo.currency.displaySymbol}}
                                </td>

                                <td class="width25">
                                    <label>{{ 'label.input.paymenttype' | translate}}<span class="required">*</span></label>
                                </td>
                                <td class="width25 paddedbottom10">
                                    <select id="paymentTypeId" ng-model="formRequestData.disburse.paymentTypeId" class="form-control" ng-options="paymentType.id as paymentType.name for paymentType in paymentTypes" value="{{paymentType.id}}"></select>
                                </td>

                            </tr>
                        </table>
                        <hr>
                            <div ng-if="showEmiDetailsInDisbursement">
                                <div ng-show="changeLoanEMIPack">
                                    <button type="button" ng-click="changeLoanEMIPack=false" class="btn btn-primary ng-binding">{{'label.button.back'| translate}}
                                    </button>
                                </div>                        
                                <div ng-hide="changeLoanEMIPack">
                                    <button type="button" ng-click="changeLoanEMIPack=true" has-permission='UPDATE_LOANAPPLICATIONREFERENCE' class="btn btn-primary ng-binding">{{'label.button.changeemipack'| translate}}
                                    </button>
                                </div>
                                    <table class="table  table-striped" ng-show="changeLoanEMIPack">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th>{{ 'label.heading.sanctionAmount' | translate }}</th>
                                                <th>{{ 'label.heading.repaymentEvery' | translate }}</th>
                                                <th>{{ 'label.heading.numberOfRepayments' | translate }}</th>
                                                <th>{{ 'label.heading.fixedEmi' | translate }}</th>
                                                <th ng-show="loanaccountinfo.multiDisburseLoan">{{ 'label.heading.disbursalAmount1' | translate }}</th>
                                                <th ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 1">{{ 'label.heading.disbursalAmount2' | translate }}</th>
                                                <th ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 2">{{ 'label.heading.disbursalAmount3' | translate }}</th>
                                                <th ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 3">{{ 'label.heading.disbursalAmount4' | translate }}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr data-ng-repeat="loanEMIPack in loanaccountinfo.loanEMIPacks | filter:filterText" ng-if="loanEMIPack.sanctionAmount <= formData.loanEMIPackData.sanctionAmount">
                                                <td class="col-md-1">
                                                    <input type="radio" ng-model="formRequestData.disburse.loanEMIPackId" value="{{loanEMIPack.id}}" ng-change="updateloanEmiPacks()"/>
                                                </td>
                                                <td class="col-md-1">
                                                    <span>{{loanEMIPack.sanctionAmount}}</span>
                                                </td>
                                                <td class="col-md-1">
                                                    <span>{{loanEMIPack.repaymentEvery}} - {{loanEMIPack.repaymentFrequencyType.value}}</span>
                                                </td>
                                                <td class="col-md-1">
                                                    <span>{{loanEMIPack.numberOfRepayments}}</span>
                                                </td>
                                                <td class="col-md-1">
                                                    <span>{{loanEMIPack.fixedEmi}}</span>
                                                </td>
                                                <td class="col-md-1" ng-show="loanaccountinfo.multiDisburseLoan">
                                                    <span>{{loanEMIPack.disbursalAmount1}}</span>
                                                </td>
                                                <td class="col-md-1" ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 1">
                                                    <span>{{loanEMIPack.disbursalAmount2}}</span>
                                                </td>
                                                <td class="col-md-1" ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 2">
                                                    <span>{{loanEMIPack.disbursalAmount3}}</span>
                                                </td>
                                                <td class="col-md-1" ng-show="loanaccountinfo.multiDisburseLoan && loanaccountinfo.product.maxTrancheCount > 3">
                                                    <span>{{loanEMIPack.disbursalAmount4}}</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                            </div>
                                    <br>
                                <div ng-show="loanaccountinfo.product.multiDisburseLoan && formRequestData.disburse.disbursementData">
                                    <hr/>
                                    <label>
                                        <strong>{{ 'label.heading.tranchedetails' | translate }}</strong>
                                    </label>
                                    <table class="width100">
                                        <tr>
                                        <td class="width14"><label>{{'label.input.outstandingloanbalance' |
                                            translate}}:</label>
                                        </td>
                                        <td class="width36 paddedbottom10">
                                            <input id="maxOutstandingLoanBalance" type="text" autocomplete="off"
                                                   ng-model="loanaccountinfo.maxOutstandingLoanBalance"
                                                   class="form-control"
                                                   number-format/>&nbsp;

                                            <a href="javascript:void(0)"
                                               title="{{ 'label.button.addtranch' | translate }}"
                                               ng-click="addTranches()"
                                               ng-show="showAddTranche()">
                                                <i class="icon-plus icon-white"></i>
                                            </a>
                                        </td>
                                        </tr>
                                    </table>
                                    <table class="table width100"
                                       ng-show="formRequestData.disburse.disbursementData && formRequestData.disburse.disbursementData.length>0">
                                        <thead>
                                            <tr class="graybg">
                                                <th>{{'label.heading.serialno' | translate}}</th>
                                                <th>{{'label.input.expecteddisbursementon' | translate}}</th>
                                                <th>{{'label.input.principal' | translate}}</th>
                                                <th data-ng-show="loanaccountinfo.product.isFlatInterestRate">{{'label.input.discountondisbursalamount' | translate}}</th>
                                                <th>{{'label.heading.actions' | translate}}</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="disbursementDetail in formRequestData.disburse.disbursementData track by $index">
                                                <td>{{($index+1)}}</td>
                                                <td>
                                                   <input id="{{disbursementDetail[$index].expectedTrancheDisbursementDate}}"
                                                   name="expectedTrancheDisbursementDate" type="text" autocomplete="off"
                                                   datepicker-pop="{{df}}"
                                                   placeholder="{{'label.input.expecteddisbursementon' | translate}}"
                                                   ng-model="disbursementDetail.expectedDisbursementDate"
                                                   is-open="'openedtranche'+$index" min="minDate" max="globalMaxDate"
                                                   class="form-control" ng-disabled = "$index == 0"/>
                                                   <form-validate valattributeform="approveloanapplicationform"
                                                           valattribute="expectedTrancheDisbursementDate"/>
                                                </td>
                                                <td>
                                                    <input id="{{disbursementDetail[$index].trancheAmount}}"
                                                   name="trancheAmount"
                                                   class="input-sm form-control"
                                                   number-format type="text" autocomplete="off"
                                                   ng-model="disbursementDetail.principal"
                                                   placeholder="{{'label.input.principal' | translate}}" required
                                                   late-validate=""  ng-blur="validateTransactionAmount($index)">

                                                   <form-validate valattributeform="approveloanapplicationform"
                                                           valattribute="trancheAmount"/>
                                                </td>
                                                <td data-ng-show="loanaccountinfo.product.isFlatInterestRate">
                                                    <input id="{{disbursementDetail[$index].discountOnDisbursalAmount}}"  class="input-sm form-control" number-format type="text" autocomplete="off" ng-model="disbursementDetail.discountOnDisbursalAmount" name="discountOnDisbursalAmount"
                                                    placeholder="{{'label.input.discountondisbursalamount' | translate}}">
                                                </td>
                                                <td><a ng-click="deleteTranches($index)"
                                                    ng-show="formRequestData.disburse.disbursementData.length > 1">
                                                    <i class="icon-remove icon-white"></i></a>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                        <table class="width100">
                            <tr>
                                <td class="width25">
                                    <label>{{ 'label.anchor.showpaymentdetails' | translate}}
                                        <span class="required"></span></label>
                                </td>
                                <td class="width25 paddedbottom10">
                                    <a class="btn btn-primary" ng-click="showPaymentDetails=!showPaymentDetails">
                                        <i ng-show="showPaymentDetails" class="icon-minus icon-white"></i>
                                        <i ng-show="!showPaymentDetails" class="icon-plus icon-white"></i>
                                    </a>
                                </td>
                                <td class="width25"></td>
                                <td class="width25 paddedbottom10"></td>
                            </tr>
                            <tr>
                                <td colspan="4">
                                    <div collapse="!showPaymentDetails">
                                        <div class="form-group">
                                            <label class="control-label col-sm-3" for="accountNumber">{{ 'label.input.accnum' | translate}}</label>

                                            <div class="col-sm-3">
                                                <input id="accountNumber" type="text" autocomplete="off" class="form-control" ng-model="formRequestData.disburse.accountNumber">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-sm-3" for="checkNumber">{{ 'label.input.checknumber' | translate}}
                                            </label>

                                            <div class="col-sm-3">
                                                <input id="checkNumber" class="form-control" type="text" autocomplete="off" ng-model="formRequestData.disburse.checkNumber">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-sm-3" for="routingCode">{{ 'label.input.routingcode' | translate}}
                                            </label>

                                            <div class="col-sm-3">
                                                <input id="routingCode" class="form-control" type="text" autocomplete="off" ng-model="formRequestData.disburse.routingCode">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-sm-3" for="receiptNumber">{{ 'label.input.receiptnumber' | translate}}
                                            </label>

                                            <div class="col-sm-3">
                                                <input id="receiptNumber" class="form-control" type="text" autocomplete="off" ng-model="formRequestData.disburse.receiptNumber">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="control-label col-sm-3" for="bankNumber">{{ 'label.input.banknumber' | translate}}</label>

                                            <div class="col-sm-3">
                                                <input id="bankNumber" class="form-control" type="text" autocomplete="off" ng-model="formRequestData.disburse.bankNumber">
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                        <table class="width100">
                            <tr>
                                <td class="width25">
                                    <label>{{ 'label.anchor.showbankaccountdetails' | translate}}</label>
                                </td>
                                <td class="width25 paddedbottom10">
                                    <a class="btn btn-primary" ng-click="showBankAccountDetails=!showBankAccountDetails">
                                        <i ng-show="showBankAccountDetails" class="icon-minus icon-white"></i>
                                        <i ng-show="!showBankAccountDetails" class="icon-plus icon-white"></i>
                                    </a>
                                </td>
                                <td class="width25"></td>
                                <td class="width25 paddedbottom10"></td>
                            </tr>
                            <tr>
                                <td colspan="4">
                                    <div collapse="!showBankAccountDetails">
                                        <div class="form-group">
                                            <div ng-if="bankAccountDetails.length > 0">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th></th>
                                                            <th></th>
                                                            <th>{{'label.heading.holdername' | translate}}</th>
                                                            <th>{{'label.heading.accountnumber' | translate}}</th>
                                                            <th>{{'label.heading.ifsc' | translate}}</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr class="pointer-main" ng-repeat="bankAccountDetail in bankAccountDetails">
                                                            <td class="col-md-1"></td>
                                                            <td class="col-md-1">
                                                                <input type="radio" ng-model="formData.bankAccountDetailId" value="{{bankAccountDetail.id}}" ng-click="radioCheckUncheck()" />
                                                            </td>
                                                            <td class="col-md-1">{{bankAccountDetail.name}}</td>
                                                            <td class="col-md-1">{{bankAccountDetail.accountNumber}}</td>
                                                            <td class="col-md-1">{{bankAccountDetail.ifscCode}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div>
                   
                    <button type="button" class="btn btn-primary pull-right" ng-show="repaymentscheduleinfo.periods.length > 0 && response.uiDisplayConfigurations.viewLoanAccountDetails.isHiddenFeild.viewReportButton" ng-click="viewRepaymentDetails()">{{'label.button.viewReport' | translate}}
                    </button>
                </div>

                <div ng-show="repaymentscheduleinfo.periods" ng-include="'views/loans/loanrepaymentpreview.html'" />

                <div class="col-md-offset-5">
                    <button id="cancel" type="reset" class="btn btn-default" ng-click="cancel()">
                        {{'label.button.cancel' | translate}}
                    </button>
                    <button id="save" type="submit" has-permission='DISBURSE_LOANAPPLICATIONREFERENCE' class="btn btn-primary" ng-if="allowDisburse()">{{'label.button.disburse' |translate}}
                    </button>
                    <button id="forceDisburse"  ng-click="forceDisburse()"
                    has-permission='FORCE_DISBURSE_LOANAPPLICATIONREFERENCE'
                    class="btn btn-primary" ng-if="allowForceDisburse()">{{'label.button.forcedisburse' |translate}}
                    </button>
                    <a class="btn btn-primary" href="javascript:void(0);" data-ng-click="previewRepayments(true)">
                                    {{'label.button.schedulepreview' | translate}}</a>
                </div>
            </div>

            <table class="width100">
                <tr>
                    <td colspan="4">&nbsp;</td>
                </tr>
            </table>
        </form>
    </div>
</div>