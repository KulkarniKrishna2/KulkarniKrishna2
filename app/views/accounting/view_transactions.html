<form class="col-md-12" ng-controller="ViewTransactionController">
    <ul class="breadcrumb" ng-if="productName == null">
        <li><a href="#/accounting">{{'label.anchor.accounting' | translate}}</a></li>
        <li ng-show="isFromNonPortfolio"><a href='#/bankstatementsdetails/{{bankNonPortfolioId}}/nonportfoliotransaction'>{{'label.anchor.nonportfoliotransactions' | translate}}</a></li>
        <li ng-show="isFromPortfolio"><a href='#/bankstatementsdetails/{{bankPortfolioId}}/reconciledtransaction'>{{'label.anchor.portfoliotransactions' | translate}}</a></li>
        <li class="active">{{'label.anchor.viewtransaction' | translate}}</li>
    </ul>
    <ul class="breadcrumb" ng-if="productName != null">
        <li ng-if="groupId != null"><a href="#/viewgroup/{{groupId}}">{{groupName}}</a></li>
        <li ng-if="clientId != null"><a href="#/viewclient/{{clientId}}">{{clientName}}</a></li>
        <li class="active">{{productName}}({{accountNo}})</li>
        <li class="active">{{'label.anchor.journalentries' | translate}}</li>
    </ul>
    <script type="text/ng-template" id="confirmation.html">
        <div class="modal-header silver">
            <h3 class="bolder">{{'label.transactionreverse' | translate}}</h3>
            <h4><strong class="required">{{ 'label.heading.transactionnumber' | translate }}&nbsp;:&nbsp;&nbsp;<b>{{transactionnumber}}</b></strong>
            </h4>
        </div>
        <div class="modal-footer">
            <api-validate></api-validate>
            <br>
            <button class="btn btn-warning" ng-click="cancel()">{{'label.button.cancel' | translate}}</button>
            <button class="btn btn-primary" ng-click="redirect()">{{'label.button.redirecttonewtrx' | translate}}
            </button>
        </div>
    </script>
    <script type="text/ng-template" id="reverseTransaction.html">
        <div class="modal-header silver">
            <h3 class="bolder">{{'label.heading.reverse' | translate}}</h3>
        </div>
        <div class="modal-body">
            <api-validate></api-validate>
            <br>
            <div class="form-group">
                <label class="control-label col-sm-2">{{ 'label.input.comments' | translate }}</label>
                <textarea rows="4" ng-model="data.reverseComments"></textarea>
            </div>
            <br>
            <button class="btn btn-warning" ng-click="cancel()">{{'label.button.cancel' | translate}}</button>
            <button class="btn btn-primary" ng-click="reverse()">{{'label.button.reverse' | translate}}</button>
        </div>
    </script>
    <div class="well">
        <div>
            <tabset tabset-name="journalentryTabset">
                <tab heading="{{'label.heading.journalentry' | translate}}">
                    <div class="text-right form-group">
                        <span><a id="run" ng-click="runReport()" class="btn btn-primary icon-print"></i>&nbsp;&nbsp;{{ 'label.button.print' | translate }}</a></span>
                    </div>
                    <div class="alert alert-success" role="alert" ng-if="clientId != null">These journal entries were created by the portfolio  transaction with the following details: <br> Client Loan transaction with Id : {{journalEntryTransactionId}} </div>
                    <div class="alert alert-success" role="alert" ng-if="groupId != null">These journal entries were created by the portfolio  transaction with the following details: <br> Group Loan transaction with Id : {{journalEntryTransactionId}} </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h3 class="bolder">{{ 'label.heading.transactionnumber' | translate }}&nbsp;-&nbsp;{{transactionNumber}}
                                <div class="pull-right" ng-show="manualEntry">
			            <span class="required" data-ng-show="!flag"><strong>{{ 'label.transactionisreversedonce' | translate
                            }}</strong></span>

                                    <div class="btn-group">
                                        <a data-ng-show="flag" ng-click="reverseTransaction(transactionNumber)" class="btn btn-primary" has-permission='REVERSE_JOURNALENTRY'><i class="icon-undo icon-white"></i>{{'label.button.reverse' | translate}}</a>
                                    </div>
                                </div>
                            </h3>
                        </div>

                        <table class="width100">
                            <tr>
                                <td class="width14"><label>{{'label.input.office' | translate}}</label></td>
                                <td class="width36">{{transaction.officeName}}</td>
                                <td class="width19"><label>{{'label.input.transactiondate' | translate}}</label></td>
                                <td class="width31">{{transaction.transactionDate | DateFormat}}</td>
                            </tr>
                            <tr>
                                <td class="width14"><label>{{'label.createdby' | translate}}</label></td>
                                <td class="width36">{{transaction.createdByUserName}}</td>
                                <td class="width19"><label>{{'label.createdon' | translate}}</label></td>
                                <td class="width31">{{transaction.createdDate | DateFormat}}</td>
                            </tr>
                        </table>
                        <div class="col-md-12">
                            <table class="table">
                                <thead>
                                <tr class="graybg">
                                    <th>{{'label.heading.journalentryid' | translate}}</th>
                                    <th>{{'label.heading.type' | translate}}</th>
                                    <th>{{'label.heading.account' | translate}}</th>
                                    <th>{{'label.heading.debit' | translate}}</th>
                                    <th>{{'label.heading.credit' | translate}}</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr class="pointer-main" ng-repeat="transactiondetail in transaction.journalEntryDetails">
                                    <td class="pointer">{{transaction.transactionId}}</td>
                                    <td class="pointer">{{transactiondetail.glAccountData.type.value}}</td>
                                    <td class="pointer"> {{transactiondetail.glAccountData.name}}({{transactiondetail.glAccountData.glCode}})</td>
                                    <td class="pointer">
                                        <div ng-show="transactiondetail.entryType.value == 'DEBIT'">
                                            {{transaction.currency.displaySymbol}}&nbsp;{{transactiondetail.amount | number}}
                                        </div>
                                    </td>
                                    <td class="pointer">
                                        <div ng-show="transactiondetail.entryType.value == 'CREDIT'">
                                            {{transaction.currency.displaySymbol}}&nbsp;{{transactiondetail.amount | number}}
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <hr/>
                        <div  class="row paddedleft">
                            <div class="col-md-12">
                                <h3 class="bolder">{{ 'label.heading.details' | translate }}&nbsp;:&nbsp;
                                    <a class="pointer" ng-click="viewentitytransaction(transaction.entityId,transaction.transactionId)" ng-show="transaction.entityId" tooltip="View Journal Entries">
                                        {{'label.button.showentitytransaction' | translate}}
                                    </a>
                                </h3>

                            </div>
                            <table class="modalwidth600">
                                <tr ng-show="transaction.referenceNumber">
                                    <td>{{'label.input.referencenumber' | translate}}</td>
                                    <td>{{transaction.referenceNumber}}</td>
                                </tr>
                                <tr ng-show="transaction.comments">
                                    <td>{{'label.input.comments' | translate}}</td>
                                    <td>{{transaction.comments}}</td>
                                </tr>
                                <tr ng-show="transaction.transactionDetails.paymentDetails">
                                    <td class="bolder">{{'label.heading.paymentdetails' | translate}}</td>
                                </tr>
                                <tr ng-show="transaction.transactionDetails.paymentDetails.paymentType">
                                    <td>{{ 'label.input.paymentypeid' | translate}}</td>
                                    <td> {{transaction.transactionDetails.paymentDetails.paymentType.name}}</td>
                                </tr>
                                <tr ng-show="transaction.transactionDetails.paymentDetails.accountNumber">
                                    <td>{{'label.input.accnum' | translate}}</td>
                                    <td>{{transaction.transactionDetails.paymentDetails.accountNumber}}</td>
                                </tr>
                                <tr ng-show="transaction.transactionDetails.paymentDetails.checkNumber">
                                    <td>{{'label.input.checknumber' | translate}}</td>
                                    <td>{{transaction.transactionDetails.paymentDetails.checkNumber}}</td>
                                </tr>
                                <tr ng-show="transaction.transactionDetails.paymentDetails.routingCode">
                                    <td>{{'label.input.routingcode' | translate}}</td>
                                    <td>{{transaction.transactionDetails.paymentDetails.routingCode}}</td>
                                </tr>
                                <tr ng-show="transaction.transactionDetails.paymentDetails.receiptNumber">
                                    <td>{{'label.input.receiptnumber' | translate}}</td>
                                    <td>{{transaction.transactionDetails.paymentDetails.receiptNumber}}</td>
                                </tr>
                                <tr ng-show="transaction.transactionDetails.paymentDetails.bankNumber">
                                    <td>{{'label.input.banknumber' | translate}}</td>
                                    <td>{{transaction.transactionDetails.paymentDetails.bankNumber}}</td>
                                </tr>
                                <tr>
                                    <td>{{'label.createdby' | translate}}</td>
                                    <td>{{transaction.createdByUserName}}</td>
                                </tr>
                                <tr>
                                    <td>{{'label.createdon' | translate}}</td>
                                    <td>{{transaction.createdDate | DateFormat}}</td>
                                </tr>
                            </table>
                            <div class="text-center form-group">
                                <span><a id="backpage" ng-click="back()" class="btn btn-primary icon-backward"></i>&nbsp;&nbsp;{{ 'label.button.back' | translate }}</a></span>
                            </div>
                        </div>
                        <div data-ng-hide="hidePentahoReport" class="row alert-block span tab-content">
                            <iframe id="rptLoadingFrame" ng-src="{{baseURL}}" frameborder="0" width="100%" height="600px"></iframe>
                        </div>
                    </div>
                </tab>
                <tab heading="{{journalentrydatatable.registeredTableDisplayName == null ? journalentrydatatable.registeredTableName : journalentrydatatable.registeredTableDisplayName}}" 
                ng-repeat="journalentrydatatable in journalentrydatatables" 
                select="dataTableChange(journalentrydatatable)" 
                has-permission='READ_{{journalentrydatatable.registeredTableName}}'>
                    <div>
                        <div class="btn-group pull-right">
                            <a ng-show="datatabledetails.isData" class="btn btn-danger pull-right"
                               ng-click="deleteAll(journalentrydatatable.registeredTableName, transactionIdStringvalue)" has-permission='DELETE_{{journalentrydatatable.registeredTableName}}'><i
                                    class="icon-trash icon-white"></i>{{'label.button.deleteall' | translate}}</a>
                            <a data-ng-show="showDataTableAddButton"
                               ng-href="#/makedatatableentry/{{journalentrydatatable.registeredTableName}}/{{transactionIdStringvalue}}?fromEntity=journalentry"
                               class="btn btn-primary" has-permission='CREATE_{{journalentrydatatable.registeredTableName}}'><i
                                    class="icon-plus icon-white"></i>{{'label.button.add' | translate}}</a>
                            <a data-ng-show="showDataTableEditButton"
                               ng-href="#/viewsingledatatableentry/{{journalentrydatatable.registeredTableName}}/{{transactionIdStringvalue}}?mode=edit&&fromEntity=journalentry"
                               class="btn btn-primary" has-permission='UPDATE_{{journalentrydatatable.registeredTableName}}'><i
                                    class="icon-edit icon-white"></i>{{'label.button.edit' | translate}}</a>
                        </div>
                        <br>
                        <br>

                        <div ng-show="datatabledetails.isData">
                            <table class="table" data-ng-show="datatabledetails.isMultirow">
                                <thead>
                                <th ng-repeat="column in datatabledetails.columnHeaders">{{column.columnName | prettifyDataTableColumn}}</th>
                                </thead>
                                <tbody>
                                <tr class="pointer-main" ng-repeat="data in datatabledetails.data">
                                    <td class="pointer" ng-repeat="row in data.row track by $index"
                                        ng-click="viewDataTable(journalentrydatatable.registeredTableName,data)">{{row}}
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                            <table class="table table-bordered width450px" data-ng-hide="datatabledetails.isMultirow">
                                <tr ng-repeat="value in singleRow">
                                    <td class="graybg table-font-nav">{{value.key | prettifyDataTableColumn}}</td>
                                    <td><span class="padded-td">{{value.value}}</span></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </tab>
            </tabset>
        </div>
    </div>
</form>
