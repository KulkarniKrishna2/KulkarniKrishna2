<div class="col-md-12" ng-controller="LoanAccountActionsController">
<div>
    <ul class="breadcrumb">
        <li><a href="#/viewloanaccount/{{accountId}}">{{'label.anchor.viewloanaccount' | translate}}</a></li>
        <li ng-show="action=='repayment' && isInterBranchTransaction">
           <a ng-click="routeToInterBranchDetails(accountId)">{{'label.anchor.inter.branch.search.details' | translate}}
           </a>
        </li>
        <li class="active">{{'label.anchor.'+action | translate}}</li>
    </ul>
</div>
<loan-header-details></loan-header-details>
    <script type="text/ng-template" id="fingerprint.html">
        <div class="modal-header silver">
            <h3 class="bolder">{{'label.heading.fingerprint' | translate}}</h3>
        </div>
        <div class="modal-body">
            <form name="popupform" novalidate="">
                <fieldset>
                    <div class="form-group row">
                        <div class="btn-group-vertical">
                            <BR><BR>
                            <button class="btn btn-danger pull-right" ng-click="clearFingerPrint()">{{'label.button.clear' | translate}} </button>
                            <button class="btn btn-info pull-right" ng-click="captureFingerprint()">{{'label.button.capture' | translate}} </button>
                        </div>
                        <div class="col-sm-3">
                            <img id="biometric"  name = "biometric" height="200" width="128" style="border: 1px #e4e4e4 solid; border-radius:4px; box-shadow: 0 0 6px #ccc" >
                        </div>
                    </div>
                    <div class="btn-group col-md-offset-4">
                        <button class="btn btn-warning" ng-click="cancel()">{{'label.button.cancel' | translate}}
                        </button>
                        <button id="save1" type="submit" ng-click="submit()" class="btn btn-primary">{{'label.button.confirm' |
                            translate}}
                        </button>
                    </div>
                    <BR><BR>
                </fieldset>
            </form>
        </div>

    </script>

<form class="form-horizontal well" name="loanactionform" novalidate="" rc-submit="submit()">
    <api-validate></api-validate>
<fieldset>
<table width="100%">
    <tr>
        <td>
            <legend>{{ title | translate}}</legend>
        </td>
        <td ng-show="addDisburseDetails" align="right">
            <legend>
                <button type="button" class="btn btn-primary" align="right"
                        ng-click="addTranches()">{{ 'label.button.add' | translate }}
                </button>
            </legend>
        </td>
    </tr>
</table>
    <div ng-show="showRunReport" has-permission='READ_Credit Appraisal Memo' class="right">
        <button type="button" ng-click="runReport()">{{'label.buttons.credit.aprisal.report' | translate}}</button>
    </div>
<div class="form-group" ng-show="showDateField">
    <label class="control-label col-sm-2" for="modelName">{{labelName | translate}}<span
            class="required">*</span></label>

    <div class="col-sm-3">
        <input id="{{modelName}}" sort type="text" autocomplete="off" datepicker-pop="{{df}}" class="form-control"
               ng-model="formData[modelName]" min="'2000-01-01'" max="globalMaxDate" ng-readonly="isDatePickerReadOnly"/>
    </div>
    <div class="col-sm-3"  ng-show="overduechargespresent || showFetchButton">
        <a id="fetchpenalties" ng-click="fetchPenalties()" class="btn btn-primary " has-permission="'READ_OVERDUECHARGE'">{{ 'label.button.fetchpenalties' | translate }}</a>
    </div>
</div>

    <div class="form-group" ng-if="showValueDateField">
        <label class="control-label col-sm-2" for="valueDate">{{'label.input.valuedate' | translate}}</label>
    
        <div class="col-sm-3">
            <input id="valueDate" sort type="text" datepicker-pop="dd MMMM yyyy" class="form-control"
                   ng-model="formData.valueDate" min="'2000-01-01'" max="restrictDate"/>
        </div>
    </div>

    <div class="form-group" ng-if="overduechargespresent && !overdueDetailsFetched">
        <div class="col-sm-2">
            &nbsp;
        </div>
        <label class="col-sm-6" ng-if="loanOverdueChargeData.lastChargeAppliedOnDate">{{ 'label.heading.penalty.charge.posted' | translate}}  {{loanOverdueChargeData.lastChargeAppliedOnDate | DateFormat}}  {{'label.heading.penaltyapplicable' | translate }}</label>
        <label class="col-sm-6" ng-if="!loanOverdueChargeData.lastChargeAppliedOnDate">{{ 'label.heading.notposted.penaltyapplicable' | translate}} </label>

    </div>

    <div class="form-group" ng-if="showPenaltiesNotApplicable">
        <div class="col-sm-2">
            &nbsp;
        </div>
        <label class="col-sm-6 required">{{ 'label.heading.penalty.charge.not.applicable' | translate}}  
    </div>

     <div class="form-group" ng-if="showFetchButton  && overdueDetailsFetched">
        <div class="col-sm-2">
            &nbsp;
        </div>
        <label class="col-sm-6" ng-if="totalpenaltyTillDate > 0">{{ 'label.heading.penalty.charge.posted' | translate}}  {{loanOverdueChargeData.lastChargeAppliedOnDate | DateFormat}} : {{totalpenaltyTillDate | number}} </label>
        <label class="col-sm-6" ng-if="totalpenaltyTillDate <= 0">{{ 'label.heading.penaltynotapplicable' | translate}}</label>
    </div>

    <div class="form-group" ng-if="!showFetchButton && overdueDetailsFetched">
        <div class="col-sm-2">
            &nbsp;
        </div>
        <label class="col-sm-6" ng-if="totalpenaltyTillDate > 0">{{ 'label.heading.penalty.charge.posted' | translate}}  {{loanOverdueChargeData.lastChargeAppliedOnDate | DateFormat}} : {{totalpenaltyTillDate | number}}  {{'label.heading.penaltyapplicable' | translate}}</label>
        <label class="col-sm-6" ng-if="totalpenaltyTillDate <= 0">{{ 'label.heading.penaltynotapplicable' | translate}}</label>
    </div>

    <div class="form-group" ng-if="showaddpenaltymessage">
        <div class="col-sm-2">
            &nbsp;
        </div>
        <label class="col-sm-6" >{{ 'label.heading.asondate' | translate}} {{loanOverdueChargeData.penaltyCalculatedOnDate | DateFormat}} {{'label.heading.penalties.to.add' | translate}} {{penaltydiff | number}}</label>
    </div>

    <div class="form-group" ng-if="showdeletepenaltymessage">
        <div class="col-sm-2">
            &nbsp;
        </div>
        <label class="col-sm-6" >{{ 'label.heading.asondate' | translate}} {{loanOverdueChargeData.penaltyCalculatedOnDate | DateFormat}} {{'label.heading.penalties.to.reverse' | translate}} {{penaltydiff | number}}</label>
    </div>

    <div class="form-group" ng-show="showRepaymentsStartingFromDateField">
        <label class="control-label col-sm-2" for="repaymentsStartingFromDate">{{'label.input.firstrepaymenton' | translate}}</label>

        <div class="col-sm-3">
            <input id="repaymentsStartingFromDate" sort type="text" autocomplete="off" datepicker-pop="{{df}}" class="form-control"
                   ng-model="formData.repaymentsStartingFromDate" min="minDate"  max="globalMaxDate" ng-readonly="isDatePickerReadOnly"/>
        </div>
    </div>

    <div class="form-group" ng-show="(action == 'disburse' || action == 'forcedisburse' || action =='disbursetogroupbankaccounts') && (response.uiDisplayConfigurations.loanAccount.isShowField.nextRepaymentDateDisburseScreen)">
        <label class="control-label col-sm-2" for="nextRepaymentDate">{{'label.input.nextrepaymentdate' | translate}}</label>

        <div class="col-sm-3">
            <input id="{{nextRepaymentDate}}" sort type="text" autocomplete="off" datepicker-pop="{{df}}" class="form-control"
                   ng-model="nextRepaymentDate" min="'2000-01-01'" max="restrictDate" disabled="disabled" ng-readonly="isDatePickerReadOnly"/>
        </div>
    </div>
    <div class="form-group" ng-show="(action == 'disburse' || action == 'forcedisburse' || action == 'disbursetogroupbankaccounts') && ((response.uiDisplayConfigurations.loanAccount.isShowField.adjustRepaymentDateDisburseScreen) || formData.adjustRepaymentDate)">
        <label class="control-label col-sm-2" for="adjustRepaymentDate">{{'label.input.adjusteddate' | translate}}</label>

        <div class="col-sm-3">
            <input id="{{adjustRepaymentDate}}" sort type="text" autocomplete="off" datepicker-pop="{{df}}" class="form-control"
                   ng-model="formData.adjustRepaymentDate" min="minDate" max="globalMaxDate" ng-readonly="isDatePickerReadOnly"/>
        </div>
    </div>

<div class="form-group" ng-show="showApprovalAmount">
    <label class="control-label col-sm-2">{{'label.input.expecteddisbursementon' | translate}}</label>

    <div class="col-sm-3">
        <input id="expectedDisbursementDate" sort type="text" autocomplete="off" class="form-control"
               datepicker-pop="{{df}}" ng-model="expectedDisbursementDate"
               min="'2000-01-01'" ng-readonly="isDatePickerReadOnly" />
    </div>
</div>
<div class="form-group" ng-if="showApprovalAmount && !loanEMIPacks">
    <label class="control-label col-sm-2">{{ 'label.heading.approvedamount' |
        translate}}</label>

    <div class="col-sm-3">
        <input id="approvedAmt" type="text" autocomplete="off" name="amount" ng-model="formData.approvedLoanAmount" class="form-control"
               number-format required late-Validate ng-readonly="isGLIM">
    </div>
</div>
<div class="form-group col-sm-3" ng-show="approveTranches" style="width: 100%;padding-left: 26px">
    <label class="control-label col-sm-2">{{ 'label.heading.tranchedetails' | translate }}</label>

    <div>
        <table style="width:80%" class="table table-bordered">
            <tr>
                <td colspan="5" align="right">
                    <button type="button" class="btn btn-primary"
                            ng-click="addTranches()">{{ 'label.button.addTranche' | translate }}
                    </button>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>{{'label.input.expecteddisbursementon' | translate}}</td>
                <td>{{'label.account.deposit.principal.amount' | translate}}</td>
                <th ng-show="isFlatInterestRate">{{'label.input.discountondisbursalamount' | translate}}</th>
                <td>{{'label.heading.actions' | translate}}</td>
            </tr>
            <tr ng-repeat="details in disbursementDetails">
                <td>{{'label.heading.tranche' | translate}}{{$index + 1}}</td>
                <td>
                    <input id="details[{{$index}}].expectedDisbursementDate" type="text" autocomplete="off"
                           datepicker-pop="{{df}}" class="form-control"
                           ng-model="details.expectedDisbursementDate" is-open="'openedtranche'+$index"
                           min="minDate" max="globalMaxDate" ng-readonly="isDatePickerReadOnly"/>
                </td>
                <td>
                    <input type="text" autocomplete="off" class="form-control" id="details[{{$index}}].principal"
                           ng-change="addTrancheAmounts()" ng-model="details.principal">
                </td>
                <td ng-show="isFlatInterestRate">
                    <input type="text" autocomplete="off" class="form-control" id="details[{{$index}}].discountOnDisbursalAmount"
                           ng-change="addTrancheAmounts()" ng-model="details.discountOnDisbursalAmount">
                </td>

                <td>
                    <a ng-click="deleteTranches($index);addTrancheAmounts();"><i class="icon-remove icon-white"></i></a>
                </td>
            </tr>
            <tr colspan="5">
                <td>{{'label.heading.total' | translate}}</td>
                <td></td>
                <td>{{showTrancheAmountTotal}}</td>
                <td ng-show="isFlatInterestRate">{{showDiscountAmountTotal}}</td>
                <td></td>
            </tr>
        </table>
    </div>
</div>


<div class="form-group" ng-if="isLoanEmiPackEnabled && loanEMIPacks && (action =='approve' || action =='disburse')">
    <label class="control-label col-sm-2">{{ 'label.heading.chooseloanemipack' | translate }}</label>
    <div class="col-sm-3">
        <input ng-autofocus="true" ng-model="filterText" type="text" autocomplete="off" ng-keyup="onFilter()" class="form-control"  placeholder="{{'label.input.filterbytext' | translate}}"/>
    </div>
</div>
<div class="form-group" ng-if="isLoanEmiPackEnabled && loanEMIPacks && (action =='approve' || action =='disburse')">    
    <div class="col-sm-offset-2">
        <table class="table well col-sm-9">
                            <thead>
                            <tr>
                                <th></th>
                                <th>{{ 'label.heading.sanctionAmount' | translate }}</th>
                                <th>{{ 'label.heading.repaymentEvery' | translate }}</th>
                                <th>{{ 'label.heading.numberOfRepayments' | translate }}</th>
                                <th>{{ 'label.heading.fixedEmi' | translate }}</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr data-ng-repeat="loanEMIPack in loanEMIPacks | filter:filterText" ng-hide="sanctionAmount < loanEMIPack.sanctionAmount"> 
                                <td class="col-md-1">
                                    <input type="radio" ng-model="formData.loanEMIPackId" name="emipack"  value="{{loanEMIPack.id}}"/>
                                </td>
                                <td class="col-md-1">
                                    <span>{{loanEMIPack.sanctionAmount}}</span>
                                </td>
                                <td class="col-md-1">
                                    <span>{{loanEMIPack.combinedRepayEvery}}</span>
                                </td>
                                <td class="col-md-1">
                                    <span>{{loanEMIPack.numberOfRepayments}}</span>
                                </td>
                                <td class="col-md-1">
                                    <span>{{loanEMIPack.fixedEmi}}</span>
                                </td>
                            </tr>
                            </tbody>
                        </table>
    </div>
</div>    

<div ng-if="showSubsidyamountReleasedField">
    <div class="form-group" >
        <label class="control-label col-sm-2" for="subsidyamountreleased">{{ 'label.input.subsidyamountreleased' |
            translate}}<span class="required">*</span></label>

        <div class="col-sm-3">
            <input id="subsidyamountreleased" type="text" autocomplete="off" name="amount" ng-model="formData.subsidyAmountReleased"
                   class="form-control"
                   number-format required late-Validate>
        </div>
        <div class="col-sm-3">
            <form-validate valattributeform="loanactionform" valattribute="subsidyamountreleased"/>
        </div>
    </div>
</div>

    <div ng-hide="disbursementDetails">
    <div class="form-group" ng-if="showAmountField  && !(isLoanEmiPackEnabled  && loanEMIPacks && (action =='approve' || action =='disburse'))">
        <label class="control-label col-sm-2" for="transactionAmount">{{ 'label.input.transactionamount' |
            translate}}<span class="required">*</span></label>

        <div class="col-sm-3">
            <input id="transactionAmount" type="text" autocomplete="off" name="amount" ng-model="formData.transactionAmount"
                   class="form-control"
                   number-format required late-Validate ng-readonly="showGlimTransactionSection() || editGlimTransaction()">
        </div>
        <div class="col-sm-3">{{amountInwords}}</div>
        <div class="col-sm-3">
            <form-validate valattributeform="loanactionform" valattribute="amount"/>
        </div>
    </div>
        <div class="form-group" ng-if="showdiscountOnDisburse && !(isLoanEmiPackEnabled  && (action =='approve' || action =='disburse'))">
            <label class="control-label col-sm-2">{{ 'label.input.discountondisbursalamount' |
                translate}}</label>

            <div class="col-sm-3">
                <input id="discountOnDisbursalAmount" type="text" autocomplete="off" name="discountOnDisbursalAmount" ng-model="formData.discountOnDisbursalAmount"
                       class="form-control" ng-disabled="disableDiscount"
                       number-format >
            </div>
            <div class="col-sm-3">
            </div>
        </div>
        <div class="form-group" ng-show="showNetDisbursalAmount">
            <label class="control-label col-sm-2" for="transactionAmount">{{ 'label.heading.netdisbursalamount' |
                translate}}</label>

            <div class="col-sm-3">
                <input id="netDisbursalAmount" type="text" autocomplete="off" name="netDisbursalAmount" ng-model="netAmount"
                       class="form-control" ng-disabled="true"
                       number-format >
            </div>
            <div class="col-sm-3">
            </div>
        </div>

        <div class="form-group"  ng-show="showGlimTransactionSection()">
            <label class="control-label col-sm-2">{{ 'label.heading.clients' | translate }}<span class="required">*</span></label>
            <div class="col-sm-8">
                <table class="table well">
                    <thead>
                    <tr class="active">
                        <th ng-hide="action == 'repayment'"></th>
                        <th >{{'label.heading.clientid' | translate}}</th>
                        <th >{{'label.heading.clientname' | translate}}</th>
                        <th ng-show="action == 'repayment'">{{'label.heading.installmentamount' | translate}}</th>
                        <th ng-show="action == 'waiveinterest' || action == 'writeoff'">{{'label.heading.transactionamount' | translate}}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="clientMember in clientMembers" ng-init="outerIndex = $index" ng-show="(clientMember.isActive || action != 'repayment')">
                        <td ng-hide="action == 'repayment'">
                            <input type="checkbox" ng-model="clientMembers[outerIndex].isClientSelected"
                                   ng-change="getTotalAmount(clientMembers, 'transactionAmount')">
                        </td>
                        <td >{{clientMember.clientId}}</td>
                        <td >{{clientMember.clientName}}</td>
                        <td>
                            <input  type="text" autocomplete="off"
                                    class="form-control principal"
                                    name="principal"
                                    ng-model="clientMembers[outerIndex].transactionAmount"
                                    number-format ng-readonly="action != 'repayment'" ng-change="getTotalAmount(clientMembers, 'transactionAmount')"/>

                        </td>
                    </tr>

                    <tbody>
                </table>

            </div>
        </div>

        <div class="form-group" ng-show="showDefaultEmiSection()">
            <label class="control-label col-sm-2">{{'label.heading.showdefaultemi' | translate}}</label>
            <div class="col-sm-3">
                <a class="btn btn-primary" ng-click="changeDefaultAmountStatus()">
                    <i ng-show="isDefaultAmountSection" class="icon-minus icon-white"></i>
                    <i ng-show="!isDefaultAmountSection" class="icon-plus icon-white"></i>
                </a>
            </div>
        </div>

        <div class="form-group"  ng-show="showDefaultEmiSection() && isDefaultAmountSection">
            <label class="control-label col-sm-2"></label>
            <div class="col-sm-8">
                <table class="table well">
                    <thead>
                    <tr class="active">
                        <th >{{'label.heading.clientid' | translate}}</th>
                        <th >{{'label.heading.clientname' | translate}}</th>
                        <th>{{'label.heading.installmentamount' | translate}}</th>                        
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="clientMember in clientMembers" ng-init="outerIndex = $index">
                        <td >{{clientMember.clientId}}</td>
                        <td >{{clientMember.clientName}}</td>
                        <td >{{clientMember.installmentAmount}}</td>
                    </tr>
                    <tbody>
                </table>

            </div>
            <div class="col-sm-10">
                <button type= "button" ng-click="copyInstallmentAmount()" class="btn btn-primary pull-right" >
                   {{ 'label.button.copyemi' | translate}}<i class="icon-arrow-up icon-white"></i></button>
            </div>
        </div>

        <div class="form-group" ng-show="showGlimRepaymentSection()">
            <label class="control-label col-sm-2">{{'label.heading.overpaymentsection' | translate}}</label>
            <div class="col-sm-3">
                <a class="btn btn-primary" ng-click="changeOverPaymentStatus()">
                    <i ng-show="showOverPaidSection" class="icon-minus icon-white"></i>
                    <i ng-show="!showOverPaidSection" class="icon-plus icon-white"></i>
                </a>
            </div>
        </div>

        <div class="form-group"  ng-show="showGlimRepaymentSection() && showOverPaidSection">
            <label class="control-label col-sm-2"></label>
            <div class="col-sm-8">
                <table class="table well">
                    <thead>
                    <tr class="active">
                        <th >{{'label.heading.clientid' | translate}}</th>
                        <th >{{'label.heading.clientname' | translate}}</th>
                        <th>{{'label.heading.installmentamount' | translate}}</th>                        
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="clientMember in clientMembers" ng-init="outerIndex = $index" ng-show="!clientMember.isActive">
                        <td >{{clientMember.clientId}}</td>
                        <td >{{clientMember.clientName}}</td>
                        <td>
                            <input  type="text" autocomplete="off"
                                    class="form-control principal"
                                    name="principal"
                                    ng-model="clientMembers[outerIndex].transactionAmount"
                                    number-format ng-change="getTotalAmount(clientMembers, 'transactionAmount')"/>

                        </td>
                    </tr>
                    <tbody>
                </table>

            </div>
        </div>
        
        <div class="form-group"  ng-show="action == 'modifytransaction' && isGLIM">
            <label class="control-label col-sm-2">{{ 'label.heading.clients' | translate }}<span class="required">*</span></label>
            <div class="col-sm-8">
                <table class="table well">
                    <thead>
                    <tr class="active">
                        <th >{{'label.heading.clientid' | translate}}</th>
                        <th >{{'label.heading.clientname' | translate}}</th>
                        <th>{{'label.heading.transactionamount' | translate}}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="glim in glimTransactions" ng-init="outerIndex = $index">

                        <td >{{glim.clientId}}</td>
                        <td >{{glim.clientName}}</td>
                        <td>
                            <input  type="text" autocomplete="off"
                                    class="form-control principal"
                                    name="principal"
                                    ng-model="glimTransactions[outerIndex].transactionAmount"
                                    number-format ng-change="getGlimTransactionAmount(glimTransactions)"/>

                        </td>
                    </tr>
                    <tbody>
                </table>
            </div>
        </div>

    <div class="form-group" ng-show="showAmountDispaly">
        <label class="control-label col-sm-2" for="transactionAmount">{{ 'label.input.transactionamount' |
            translate}}<span class="required">*</span></label>
        <div class="col-sm-3">
            <input type="text" ng-model="amount" id="amount" class="form-control" ng-readonly="true">
        </div>
    </div>

    <div class="form-group" ng-show="principalPortion">
        <label class="control-label col-sm-2" for="principalPortion">{{ 'label.input.principal' | translate}}</label>

        <div class="col-sm-3">
            <input id="principalPortion" type="text" autocomplete="off" name="principa" ng-model="principalPortion" class="form-control"
                   number-format readonly>
        </div>
    </div>

    <div class="form-group" ng-show="interestPortion">
        <label class="control-label col-sm-2" for="interestPortion">{{ 'label.input.interest' |
            translate}}<span class="required">*</span></label>

        <div class="col-sm-3">
            <input id="interestPortion" type="text" autocomplete="off" name="interest" ng-model="interestPortion" class="form-control"
                   number-format readonly>
        </div>
    </div>

    <div class="form-group" ng-if="isLoanWriteOff">
        <label class="control-label col-sm-2" for="writeOffAmount">{{ 'label.input.amount' |
            translate}}</label>

        <div class="col-sm-3">
            <input id="writeOffAmount" type="text" autocomplete="off" name="amount" ng-model="writeOffAmount"
                   class="form-control" readonly>
        </div>
    </div>

    <div class="form-group" ng-if="isReturnLoan">
        <label class="control-label col-sm-2" for="returnLoanAmount">{{ 'label.input.amount' |
            translate}}</label>

        <div class="col-sm-3">
            <input id="returnLoanAmount" type="text" name="amount" ng-model="returnLoanAmount"
                   class="form-control" readonly>
        </div>
    </div>

    <div class="form-group"  ng-show="isLoanWriteOff">
        <label class="control-label col-sm-2">
            {{'label.input.reason' | translate}}
        </label>
        <div class="col-sm-3">
            <div >
                <select chosen="reasons" id="writeoffReasonId" ng-model="formData.writeoffReasonId"  class="form-control"
                        ng-options="reason.id as reason.name for reason in reasons" value="{{reason.id}}"
                        name="writeoffReasonId">
                    <option value="" style="display:none;">--{{'label.menu.selectreason' | translate}}--</option>
                </select>
            </div>
        </div>
    </div>

    <div class="form-group" ng-show="showPenaltyPortionDisplay">
        <label class="col-sm-5 text-right" for="transactionAmount">{{ 'label.input.payspenaltyportion' |
            translate}}</label>
    </div>



    <div class="form-group" ng-if="showEMIAmountField  && !(isLoanEmiPackEnabled  && loanEMIPacks && (action =='approve' || action =='disburse'))">
        <label class="control-label col-sm-2" for="fixedEmiAmount">{{ 'label.input.fixedemiamount' | translate}}</label>
        <div class="col-sm-3" ng-show = "showEmiAmount">
            <input type="text" autocomplete="off" class="form-control" name="emiAmount"
                   ng-model="fixedEmiAmount" readonly>
        </div>
        <div class="col-sm-3" ng-hide = "showEmiAmount">
            <input id="transactionAmount" type="text" autocomplete="off" class="form-control" name="amount"
                   ng-model="formData.fixedEmiAmount">
        </div>       
    </div>

    <div ng-show="isTransaction">
        <div  class="form-group">
            <label class="control-label col-sm-2" for="paymentTypeId">{{ 'label.input.paymentmode' | translate}}
                <span ng-show="isPaymentModeMandatory" class="required">*</span>
            </label>
            <div class="col-sm-3">
                <select id="paymentMode" name="paymentMode" ng-model="paymentMode"
                            ng-options="paymentModeOption.id as paymentModeOption.value for paymentModeOption in paymentModeOptions"
                            value="{{paymentModeOption.id}}" ng-change="updatePaymentTypeOptions()"  class="form-control"
                            ng-required="isPaymentModeMandatory">
                            <option value="">{{'label.selectone' | translate}}</option>
                       </select>
            </div>
            <div class="col-sm-3">
                <form-validate valattributeform="loanactionform" valattribute="paymentMode"/>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-2" for="paymentTypeId">{{ 'label.input.paymenttype' | translate}}
                <span ng-show="isPaymentTypeMandatory" class="required">*</span>
            </label>
            <div class="col-sm-3">
                <select id="paymentTypeId" ng-model="formData.paymentTypeId" class="form-control" name="paymentTypeId"
                        ng-options="paymentType.id as paymentType.name for paymentType in paymentTypeOptions"
                        value="{{paymentType.id}}" ng-required="isPaymentTypeMandatory" required> 
                        <option value="">{{'label.selectone' | translate}}</option>
                    </select>
            </div>
            <div class="col-sm-3">
                <form-validate valattributeform="loanactionform" valattribute="paymentTypeId"/>
            </div>
        </div>
        <div class="form-group" ng-if="showPaymentTypeForRepaymentAtDisbursement">
            <label class="control-label col-sm-2" for="paymentTypeIdForRepaymentAtDisbursement">{{ 'label.input.payment.type.for.repayment.at.disbursement' | translate}}</label>

            <div class="col-sm-3">
                <select id="paymentTypeId" ng-model="formData.paymentTypeIdForRepaymentAtDisbursement" class="form-control"
                        ng-options="paymentType.id as paymentType.name for paymentType in paymentTypes"
                        value="{{paymentType.id}}"></select>
            </div>
        </div>
        <div class="form-group">
            <label ng-hide="isRecieptNumbermandatory" class="control-label col-sm-2">{{ 'label.anchor.showpaymentdetails' | translate}}</label>

            <div ng-hide="isRecieptNumbermandatory" class="col-sm-3">
                <a class="btn btn-primary" ng-click="showPaymentDetails=!showPaymentDetails">
                    <i ng-show="showPaymentDetails" class="icon-minus icon-white"></i>
                    <i ng-show="!showPaymentDetails" class="icon-plus icon-white"></i>
                </a>
            </div>
            <div ng-show="isRecieptNumbermandatory" class="col-sm-3">
                <h3>{{ 'label.heading.paymentdetails' | translate}}</h3>
            </div>
        </div>
        <div ng-show="showPaymentDetails || isRecieptNumbermandatory">
            <div class="form-group">
                <label class="control-label col-sm-2" for="accountNumber">{{ 'label.input.accnum' | translate}}</label>

                <div class="col-sm-3">
                    <input id="accountNumber" type="text" autocomplete="off" class="form-control" ng-model="formData.accountNumber">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="checkNumber">{{ 'label.input.checknumber' |
                    translate}}</label>

                <div class="col-sm-3">
                    <input id="checkNumber" class="form-control" type="text" autocomplete="off" ng-model="formData.checkNumber">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="routingCode">{{ 'label.input.routingcode' |
                    translate}}</label>

                <div class="col-sm-3">
                    <input id="routingCode" class="form-control" type="text" autocomplete="off" ng-model="formData.routingCode">
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="receiptNumber">{{ 'label.input.receiptnumber' |
                    translate}}<span ng-if="isRecieptNumbermandatory" class="required">*</span></label>

                <div class="col-sm-3">
                    <input id="receiptNumber" name="receiptNumber" class="form-control" type="text" autocomplete="off"
                           ng-model="formData.receiptNumber" ng-required="isRecieptNumbermandatory">
                </div>
                <div class="col-sm-3">
                    <form-validate valattributeform="loanactionform" valattribute="receiptNumber"/>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-sm-2" for="bankNumber">{{ 'label.input.banknumber' | translate}}</label>

                <div class="col-sm-3">
                    <input id="bankNumber" class="form-control" type="text" autocomplete="off" ng-model="formData.bankNumber">
                </div>
            </div>
        </div>
        <div class="form-group" ng-show="(action == 'disburse')">
            <label class="control-label col-sm-2">{{ 'label.anchor.showbankaccountdetails' | translate}}</label>
            <div class="col-sm-3">
                <a class="btn btn-primary" ng-click="showBankAccountDetails=!showBankAccountDetails">
                    <i ng-show="showBankAccountDetails" class="icon-minus icon-white"></i>
                    <i ng-show="!showBankAccountDetails" class="icon-plus icon-white"></i>
                </a>
            </div>
        </div>
        <div class="form-group" ng-show="showBankAccountDetails">
            <div ng-if="bankAccountDetails.length > 0">
                <table class="table">
                    <thead>
                        <tr>
                            <th></th>
                            <th></th>
                            <th>{{'label.heading.holdername' | translate}}</th>
                            <th>{{'label.heading.accountnumber' | translate}}</th>
                            <th>{{'label.heading.ifsc' | translate}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="pointer-main"  ng-repeat="bankAccountDetail in bankAccountDetails">
                            <td class="col-md-1"></td>
                            <td class="col-md-1">
                                <input type="radio" ng-model="formData.bankAccountDetailId" ng-checked="bankAccountDetail.checked" value="{{bankAccountDetail.id}}"/>
                            </td>
                            <td class="col-md-1">{{bankAccountDetail.name}}</td>
                            <td class="col-md-1">{{bankAccountDetail.accountNumber}}</td>
                            <td class="col-md-1">{{bankAccountDetail.ifscCode}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
    <div class="form-group" ng-show="isApprovableOrDisbursable()">
        <label class="control-label col-sm-2">{{ 'label.heading.amountbreakup' | translate }}</label>
        <div  class="col-sm-6">
            <table class="table well">
                <thead>
                <tr class="active">
                    <th></th>
                    <th >{{'label.heading.clientid' | translate}}</th>
                    <th >{{'label.heading.clientname' | translate}}</th>
                    <th >{{'label.heading.externalid' | translate}}</th>
                    <th>{{'label.heading.amount' | translate}}</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="clientMember in clientMembers" ng-init="outerIndex = $index" ng-show="clientMember.isClientSelected">
                    <td>
                        <input type="checkbox" ng-model="clientMembers[outerIndex].isClientSelected" ng-change="glimAutoCalPrincipalAmount()">
                    </td>
                    <td >{{clientMember.clientId}}</td>
                    <td >{{clientMember.clientName}}</td>
                    <td >{{clientMember.clientExternalID}}</td>
                    <td>
                        <input  type="text" autocomplete="off"
                                class="form-control principal"
                                name="principal"
                                ng-model="clientMembers[outerIndex].transactionAmount"
                                number-format ng-keyup="glimAutoCalPrincipalAmount()"/>&nbsp;{{productDetails.currency.displaySymbol}}
                    </td>
                </tr>
                <tbody>
            </table>
        </div>
    </div>
    <div class="form-group" ng-show="showNoteField">
    <label class="control-label col-sm-2" for="note">{{ 'label.input.note' | translate}}</label>

    <div class="col-sm-3">
        <textarea id="note" rows="2" class="form-control" ng-model="formData.note" ng-change="checkNote()"></textarea>
    </div>
    <div class="col-sm-3" ng-show="backDatedTxnError==true">
        <span class="error">{{'label.requiredfield' | translate}}</span>
    </div>
</div>
<div class="form-group" ng-show="installmentchargeField">
    <label class="control-label col-sm-2" for="note">{{ 'label.input.installment' | translate}}</label>

    <div class="col-sm-3">
        <select id="installmentNumber" ng-model="formData.installmentNumber" class="form-control"
                ng-options="installmentCharge.installmentNumber as installmentCharge.installmentNumber for installmentCharge in installmentCharges"
                value="{{installmentCharge.installmentNumber}}"></select>
    </div>
</div>
<div class="form-group" ng-show="paymentDatefield">
    <label class="control-label col-sm-2" for="modelName">{{'label.input.paymentdate' | translate}}<span
            class="required">*</span></label>

    <div class="col-sm-3">
        <input id="{{modelName}}" class="form-control" type="text" autocomplete="off" sort datepicker-pop="{{df}}"
               ng-model="formData.transactionDate" is-open="opened" ng-readonly="isDatePickerReadOnly" />
    </div>
</div>
<div class="form-group" ng-show="showEditChargeAmount">
    <label class="control-label col-sm-2">{{ 'label.input.amount' | translate}}<span
            class="required">*</span></label>

    <div class="col-sm-3">
        <input type="text" autocomplete="off" class="form-control" id="amount" ng-model="formData.amount">
    </div>
</div>
<div class="form-group" ng-show="showEditChargeDueDate">
    <label class="control-label col-sm-2" for="modelName">{{'label.input.dueforcollectedon' | translate}}<span
            class="required">*</span></label>

    <div class="col-sm-3">
        <input id="{{modelName}}" type="text" autocomplete="off" sort datepicker-pop="{{df}}" class="form-control"
               ng-model="formData.dueDate"
               is-open="opened" ng-readonly="isDatePickerReadOnly"/>
    </div>
</div>
<div class="form-group" ng-if="showEditDisburseDate">
    <label class="control-label col-sm-2" for="modelName">{{'label.input.expecteddisbursementon' | translate}}<span
            class="required">*</span></label>

    <div class="col-sm-3">
        <input id="{{modelName}}" type="text" autocomplete="off" sort datepicker-pop="{{df}}" class="form-control"
               ng-model="formData.updatedExpectedDisbursementDate" is-open="opened" ng-readonly="isDatePickerReadOnly"/>
    </div>
    <div class="form-group">
        <label class="control-label col-sm-2">{{ 'label.heading.principal' |
            translate}}<span class="required">*</span></label>

        <div class="col-sm-3">
            <input id="principal" type="text" autocomplete="off" name="amount" ng-model="formData.updatedPrincipal" class="form-control"
                   number-format required late-Validate>
        </div>
    </div>
    </div>

    <table class="table width100" ng-show="addDisburseDetails && disbursementDetails.length > 0">
        <thead>
        <tr class="graybg">
            <th>{{'label.input.expecteddisbursementon' | translate}}</th>
            <th>{{'label.input.principal' | translate}}</th>
            <th ng-show="isFlatInterestRate">{{'label.input.discountondisbursalamount' | translate}}</th>
            <th>{{'label.input.actions' | translate}}</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="disbursementDetail in disbursementDetails">
            <td ng-hide="disbursementDetail.id">
                <input id="disbursementDetail[{{$index}}].expectedDisbursementDate" type="text" autocomplete="off"
                       datepicker-pop="{{df}}" class="form-control"
                       placeholder="{{'label.input.expecteddisbursementon' | translate}}"
                       ng-model="disbursementDetail.expectedDisbursementDate" is-open="'openedtranche'+$index"
                       min="minDate" max="globalMaxDate" ng-readonly="isDatePickerReadOnly"/>
            </td>
            <td ng-hide="disbursementDetail.id">
                <input id="{{disbursementDetail[$index].principal}}" class="form-control" number-format type="text" autocomplete="off"
                       ng-model="disbursementDetail.principal"
                       placeholder="{{'label.input.principal' | translate}}">
            </td>
            <td ng-hide="disbursementDetail.id || !isFlatInterestRate">
                <input id="{{disbursementDetail[$index].discountOnDisbursalAmount}}" class="form-control" number-format type="text" autocomplete="off"
                       ng-model="disbursementDetail.discountOnDisbursalAmount"
                       placeholder="{{'label.input.discountondisbursalamount' | translate}}">
            </td>
            <td ng-hide="disbursementDetail.id"><a ng-click="deleteTranches($index)"><i
                    class="icon-remove icon-white"></i></a></td>
        </tr>
        </tbody>
    </table>
    <table class="table width100" ng-show="deleteDisburseDetails && disbursementDetails.length > 0">
        <thead>
        <tr class="graybg">
            <th>{{'label.input.expecteddisbursementon' | translate}}</th>
            <th>{{'label.input.principal' | translate}}</th>
            <th ng-show="isFlatInterestRate">{{'label.input.discountondisbursalamount' | translate}}</th>
            <th>{{'label.input.actions' | translate}}</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="disbursementDetail in disbursementDetails">
            <td>
                <input id="disbursementDetail[{{$index}}].expectedDisbursementDate" type="text" autocomplete="off"
                       datepicker-pop="{{df}}" class="form-control"
                       placeholder="{{'label.input.expecteddisbursementon' | translate}}"
                       ng-model="disbursementDetail.expectedDisbursementDate" ng-disabled="true"
                       is-open="'openedtranche'+$index"
                       ng-show="disbursementDetail.actualDisbursementDate == null"
                       min="minDate" max="globalMaxDate" ng-readonly="isDatePickerReadOnly"/>
            </td>
            <td>
                <input id="{{disbursementDetail[$index].principal}}" class="form-control" number-format type="text" autocomplete="off"
                       ng-model="disbursementDetail.principal"
                       ng-show="disbursementDetail.actualDisbursementDate == null"
                       placeholder="{{'label.input.principal' | translate}}" ng-disabled="true">
            </td>
            <td ng-hide="disbursementDetail.id && !isFlatInterestRate">
                <input id="{{disbursementDetail[$index].discountOnDisbursalAmount}}" class="form-control" number-format type="text" autocomplete="off"
                       ng-model="disbursementDetail.discountOnDisbursalAmount"
                       placeholder="{{'label.input.discountondisbursalamount' | translate}}">
            </td>
            <td ng-show="disbursementDetail.actualDisbursementDate == null"><a ng-click="deleteTranches($index)"><i
                    class="icon-remove icon-white"></i></a></td>
        </tr>
        </tbody>
    </table>
<div class="form-group" ng-show="showDelete">
    <label class="control-label col-sm-2">{{ 'label.areyousure' | translate}}</label>
</div>
<div class="col-md-offset-2" ng-show="showDelete || showwaiveforspecicficduedate">
    <button type="reset" ng-click="cancel()" class="btn btn-default">{{ 'label.button.cancel' | translate}}</button>
    <button type="submit" has-permission='{{taskPermissionName}}' ng-click="submit()" class="btn btn-primary">{{
        'label.button.confirm' |
        translate}}
    </button>

</div>
<div class="form-group"  ng-if= "action =='disbursetogroupbankaccounts'">
    <h4>{{ 'label.heading.group.bank.account.details' | translate}}</h4>
    <hr/>

    <div class="form-group">
        <label class="control-label col-sm-2">{{ 'label.input.holdername' | translate }}<span
                        class="required">*</span></label>
        <div class="col-sm-2">
            <select id="bankId"  name = "bankId" ng-model="bankAccountTemplate.bankAccountAssociation" class="form-control" ng-options="accountDetails.bankAccountDetails.name +'-'+accountDetails.loanPurpose  for accountDetails in groupBankAccountDetailsData"
            value="{{accountDetails.groupBankAccountDetailAssociationId}}">
                <option value="">{{'label.menu.selectbank' | translate}}</option>
            </select>
        </div>
       
        <div class="row">
            <label class="control-label col-sm-1">{{ 'label.input.amount' | translate }}<span
                        class="required">*</span></label>
            <div class="col-sm-2">
                <input ng-model="bankAccountTemplate.disbursalAmount" name="columnname" type="text" autocomplete="off" class="form-control" ng-pattern="/^[0-9]*$/"/>
            </div>
            <div class="col-sm-2">
                <a ng-click="addDisbursalAmount()"><i class="icon-plus icon-white"></i></a>
                <span ng-show="isInvalid">
                    <small class="error">{{ errorMessage | translate }}</small>
                </span>
            </div>
        </div>
    </div>
    <div class="col-sm-8" ng-if="multipleBankDisbursalData.length > 0" class="form-group width70">
        <br/>
        <table ng-show="multipleBankDisbursalData.length > 0" class="table">
            <tr class="graybg">
                <th class="col-sm-1 align="center">{{'label.heading.serialno' | translate}}</th>
                <th class="col-sm-3" align="center">{{'label.input.holdername' | translate}}</th>
                <th class="col-sm-2" align="center">{{'label.input.amount' | translate}}</th>
                <th class="col-sm-1" align="center">{{'label.heading.actions' | translate}}</th>
            </tr>
            <tr ng-repeat="record in multipleBankDisbursalData">
                <td class="col-sm-1"><label> {{$index+1}} </label></td>
                <td class="col-sm-3">{{record.name}}-{{record.loanPurpose}} </td>
                <td class="col-sm-2">{{record.amount}} </td>
                <td class="col-sm-1">
                    <button data-ng-if="multipleBankDisbursalData.length > 0" type="button" class="btn-link ng-binding"><i class="icon-remove icon-white" ng-click="deleteRecord($index)"></i>
                    </button>
                </td>         
            </tr>
        </table>
    </div>
</div>
<div class="col-md-offset-2" ng-hide="showDelete || showwaiveforspecicficduedate">
    <button id="cancel" type="reset" class="btn btn-default" ng-click="cancel()">{{ 'label.button.cancel' |
        translate}}
    </button>
    <button type="button" 
    data-text="{{confirmText}}"
    data-confirm-popup 
    ng-confirm-success="submit()"
    class="btn btn-primary btn-xs" 
    ng-if="isConfirmNeeded"
    >{{submitbutton | translate}}</button>

    <button id="save" type="submit" has-permission='{{taskPermissionName}}' class="btn btn-primary" ng-hide="showPenaltiesNotApplicable" ng-if="!isConfirmNeeded">{{
        submitbutton | translate}}
    </button> 


</div>
    <div collapse="hidePentahoReport" class="row alert-block span tab-content">
        <br>
        <iframe id="rptLoadingFrame" ng-src="{{baseURL}}" frameborder="0" width="100%" height="600px"></iframe>
    </div>
</fieldset>
</form>
</div>

